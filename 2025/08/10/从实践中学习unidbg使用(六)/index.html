<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­) | NshIdE&#39;s Home</title>
  <meta name="keywords" content=" Unidbg ">
  <meta name="description" content="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­) | NshIdE&#39;s Home">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta property="og:type" content="website">
<meta property="og:title" content="categories">
<meta property="og:url" content="https://nshide1.github.io/categories/">
<meta property="og:site_name" content="NshIdE&#39;s Home">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-03-04T12:19:41.475Z">
<meta property="article:modified_time" content="2025-03-04T12:19:41.475Z">
<meta property="article:author" content="NshIdE">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/logo.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-dark.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 7.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/logo.jpg"/>
</a>
<div class="author">
    <span>NshIdE</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/NshIdE1/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="zhihu"
               href="https://www.zhihu.com/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-zhihu"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="csdn"
               href="https://www.csdn.net/"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-csdn"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=1621925986&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(42)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="å…¶ä»–">
            
            å…¶ä»–
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Android-RE">
            
            Android-RE
            <small>(2)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Androidå­¦ä¹ ">
            
            Androidå­¦ä¹ 
            <small>(10)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Angrå…¥é—¨">
            
            Angrå…¥é—¨
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="CTF">
            
            CTF
            <small>(16)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Fridaå…¥é—¨">
            
            Fridaå…¥é—¨
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Javaå­¦ä¹ ">
            
            Javaå­¦ä¹ 
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Unidbgå­¦ä¹ ">
            
            Unidbgå­¦ä¹ 
            <small>(10)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="42">
<input type="hidden" id="yelog_site_word_count" value="231.8k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="https://bananashipsbbq.github.io/">bananaships</a></li>
            
            <li><a target="_blank" href="https://astralprisma.github.io/">AstralPrisma</a></li>
            
            <li><a target="_blank" href="https://monoceros406.github.io/">Monoceros406</a></li>
            
            <li><a target="_blank" href="https://github.com/Thir0th">Thir0th</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="search shortcut key i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="switch to outline view shortcut key w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="return"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="case sensitive"></i>
            <i class="iconfont icon-tag" data-title="label"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">outline</div>
            <i class="iconfont icon-list" data-title="switch to article list"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æŠ½è±¡</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ç¬¦å·æ‰§è¡Œ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å–è¯</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å®æˆ˜</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åº”æ€¥å“åº”</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Android</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>CTF</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Frida</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>go</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Harmony</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>il2Cpps</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>iOS</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>ISW</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Linux</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>RE</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>SIMD</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Unidbg</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Unity</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>vm</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>WritesUp</a>
            </li>
        
    </div>

</div>

    
    <div id="local-search-result">

    </div>
    
    <nav id="title-list-nav">
        
        
        <a  class="All CTF "
           href="/2026/01/04/HitCTF2025-Reverse%C2%B7VM/"
           data-tag="CTF,RE,WritesUp,vm"
           data-author="" >
            <span class="post-title" title="HitCTF2025-ReverseÂ·VM">HitCTF2025-ReverseÂ·VM</span>
            <span class="post-date" title="2026-01-04 16:19:02">2026/01/04</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/11/03/%E6%9F%90%E9%BB%91%E7%9B%92%20App%20%E7%99%BB%E5%BD%95%E5%8F%82%E6%95%B0%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/"
           data-tag="Android,å®æˆ˜"
           data-author="" >
            <span class="post-title" title="æŸé»‘ç›’ App ç™»å½•å‚æ•°é€†å‘åˆ†æ">æŸé»‘ç›’ App ç™»å½•å‚æ•°é€†å‘åˆ†æ</span>
            <span class="post-date" title="2025-11-03 16:15:21">2025/11/03</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/10/25/%E7%AC%AC%E5%85%AB%E5%B1%8A%E5%BC%BA%E7%BD%91%C2%B7%E6%8B%9F%E6%80%81%E9%98%B2%E5%BE%A1%E5%9B%BD%E9%99%85%E7%B2%BE%E8%8B%B1%E6%8C%91%E6%88%98%E8%B5%9B/"
           data-tag="CTF,RE,WritesUp,Android,il2Cpps"
           data-author="" >
            <span class="post-title" title="ç¬¬å…«å±Šå¼ºç½‘Â·æ‹Ÿæ€é˜²å¾¡å›½é™…ç²¾è‹±æŒ‘æˆ˜èµ›">ç¬¬å…«å±Šå¼ºç½‘Â·æ‹Ÿæ€é˜²å¾¡å›½é™…ç²¾è‹±æŒ‘æˆ˜èµ›</span>
            <span class="post-date" title="2025-10-25 17:31:37">2025/10/25</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/10/22/Android%20APP%20%E5%B8%B8%E8%A7%81%E6%BC%8F%E6%B4%9E/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android APP å¸¸è§æ¼æ´">Android APP å¸¸è§æ¼æ´</span>
            <span class="post-date" title="2025-10-22 17:06:07">2025/10/22</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/10/10/%E4%BB%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%20PackageInfo%20%E5%92%8C%20LoadedApk/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="ä»æºç åˆ†æ PackageInfo å’Œ LoadedApk">ä»æºç åˆ†æ PackageInfo å’Œ LoadedApk</span>
            <span class="post-date" title="2025-10-10 18:15:17">2025/10/10</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/09/09/2025%E5%B9%B4%E6%B9%BE%E5%8C%BA%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9B/"
           data-tag="CTF,RE,WritesUp,Android"
           data-author="" >
            <span class="post-title" title="2025å¹´æ¹¾åŒºæ¯ç½‘ç»œå®‰å…¨å¤§èµ›åˆèµ›">2025å¹´æ¹¾åŒºæ¯ç½‘ç»œå®‰å…¨å¤§èµ›åˆèµ›</span>
            <span class="post-date" title="2025-09-09 09:34:17">2025/09/09</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/09/08/Android%20SO%20%E6%96%87%E4%BB%B6%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android SO æ–‡ä»¶åŠ è½½è¿‡ç¨‹">Android SO æ–‡ä»¶åŠ è½½è¿‡ç¨‹</span>
            <span class="post-date" title="2025-09-08 17:18:50">2025/09/08</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/25/Dex%20%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Dex æ–‡ä»¶ç»“æ„å­¦ä¹ ">Dex æ–‡ä»¶ç»“æ„å­¦ä¹ </span>
            <span class="post-date" title="2025-08-25 17:33:29">2025/08/25</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/19/ClassLoader%20%E6%9C%BA%E5%88%B6/"
           data-tag="Android,Java"
           data-author="" >
            <span class="post-title" title="ClassLoader æœºåˆ¶">ClassLoader æœºåˆ¶</span>
            <span class="post-date" title="2025-08-19 17:42:51">2025/08/19</span>
        </a>
        
        
        <a  class="All Javaå­¦ä¹  "
           href="/2025/08/19/Java%E5%AD%A6%E4%B9%A0%E2%80%94%E2%80%94%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"
           data-tag="Android,Java"
           data-author="" >
            <span class="post-title" title="Javaå­¦ä¹ ----åå°„æœºåˆ¶">Javaå­¦ä¹ ----åå°„æœºåˆ¶</span>
            <span class="post-date" title="2025-08-19 17:00:02">2025/08/19</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/19/Android%20%E5%BA%94%E7%94%A8%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android åº”ç”¨å¯åŠ¨æµç¨‹">Android åº”ç”¨å¯åŠ¨æµç¨‹</span>
            <span class="post-date" title="2025-08-19 11:14:13">2025/08/19</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/19/%E5%AE%89%E5%8D%93%E5%8A%A0%E5%9B%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="å®‰å“åŠ å›ºå­¦ä¹ è®°å½•">å®‰å“åŠ å›ºå­¦ä¹ è®°å½•</span>
            <span class="post-date" title="2025-08-19 10:50:46">2025/08/19</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/14/Android%20%E5%BC%80%E5%8F%91%E2%80%94%E2%80%94NDK%20%E5%BC%80%E5%8F%91/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="Android å¼€å‘--NDK å¼€å‘">Android å¼€å‘--NDK å¼€å‘</span>
            <span class="post-date" title="2025-08-14 17:56:58">2025/08/14</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/08/10/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E5%85%AD)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)</span>
            <span class="post-date" title="2025-08-10 10:25:02">2025/08/10</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/08/08/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E4%BA%94)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(äº”)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(äº”)</span>
            <span class="post-date" title="2025-08-08 17:45:59">2025/08/08</span>
        </a>
        
        
        <a  class="All Androidå­¦ä¹  "
           href="/2025/08/05/%E6%BC%AB%E8%B0%88%E5%94%AF%E4%B8%80%E8%AE%BE%E5%A4%87ID/"
           data-tag="Android"
           data-author="" >
            <span class="post-title" title="æ¼«è°ˆå”¯ä¸€è®¾å¤‡ ID">æ¼«è°ˆå”¯ä¸€è®¾å¤‡ ID</span>
            <span class="post-date" title="2025-08-05 18:00:44">2025/08/05</span>
        </a>
        
        
        <a  class="All å…¶ä»– "
           href="/2025/07/24/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%20Linux%20%E7%B3%BB%E7%BB%9F%E4%B8%8B%20proc%20%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%86%85%E5%AE%B9/"
           data-tag="Android,Linux"
           data-author="" >
            <span class="post-title" title="æµ…è°ˆ Linux ç³»ç»Ÿä¸‹ proc æ–‡ä»¶ç³»ç»Ÿå†…å®¹">æµ…è°ˆ Linux ç³»ç»Ÿä¸‹ proc æ–‡ä»¶ç³»ç»Ÿå†…å®¹</span>
            <span class="post-date" title="2025-07-24 17:56:57">2025/07/24</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/07/24/Unidbg%20%E4%B8%AD%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%EF%BC%88%E4%BA%8C%EF%BC%89/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="Unidbg ä¸­å¤„ç†æ–‡ä»¶è®¿é—®(äºŒ)">Unidbg ä¸­å¤„ç†æ–‡ä»¶è®¿é—®(äºŒ)</span>
            <span class="post-date" title="2025-07-24 17:00:12">2025/07/24</span>
        </a>
        
        
        <a  class="All Android-RE "
           href="/2025/07/23/2025%E7%AC%AC%E5%8D%81%E5%B1%8A%E6%B8%B8%E6%88%8F%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B-%E5%88%9D%E8%B5%9B-%E5%AE%89%E5%8D%93%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%AE%89%E5%85%A8/"
           data-tag="RE,WritesUp,Android"
           data-author="" >
            <span class="post-title" title="2025ç¬¬åå±Šæ¸¸æˆå®‰å…¨ç«èµ›-åˆèµ›-å®‰å“å®¢æˆ·ç«¯å®‰å…¨">2025ç¬¬åå±Šæ¸¸æˆå®‰å…¨ç«èµ›-åˆèµ›-å®‰å“å®¢æˆ·ç«¯å®‰å…¨</span>
            <span class="post-date" title="2025-07-23 15:32:11">2025/07/23</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/07/19/%E5%88%9B%E5%BB%BA%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%92%8C%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="åˆ›å»ºæ¨¡æ‹Ÿå™¨å’ŒåŠ è½½æ¨¡å—">åˆ›å»ºæ¨¡æ‹Ÿå™¨å’ŒåŠ è½½æ¨¡å—</span>
            <span class="post-date" title="2025-07-19 15:14:29">2025/07/19</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/07/15/Unidbg%20%E4%B8%AD%E5%A4%84%E7%90%86%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%EF%BC%88%E4%B8%80%EF%BC%89/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="Unidbg ä¸­å¤„ç†æ–‡ä»¶è®¿é—®(ä¸€)">Unidbg ä¸­å¤„ç†æ–‡ä»¶è®¿é—®(ä¸€)</span>
            <span class="post-date" title="2025-07-15 16:52:06">2025/07/15</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/07/08/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E5%9B%9B)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å››)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å››)</span>
            <span class="post-date" title="2025-07-08 11:44:49">2025/07/08</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/07/01/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E4%B8%89)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(ä¸‰)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(ä¸‰)</span>
            <span class="post-date" title="2025-07-01 15:29:42">2025/07/01</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/06/07/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmonyCTF/"
           data-tag="CTF,RE,WritesUp,Harmony"
           data-author="" >
            <span class="post-title" title="ç¬¬ä¸€å±ŠOpenHarmonyCTF">ç¬¬ä¸€å±ŠOpenHarmonyCTF</span>
            <span class="post-date" title="2025-06-07 13:32:45">2025/06/07</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/06/04/%E8%A1%A5%E5%BA%93%E5%87%BD%E6%95%B0%EF%BC%88%E4%BA%94%EF%BC%89/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="è¡¥åº“å‡½æ•°(äº”)">è¡¥åº“å‡½æ•°(äº”)</span>
            <span class="post-date" title="2025-06-04 19:07:56">2025/06/04</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/06/02/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E4%BA%8C)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(äºŒ)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(äºŒ)</span>
            <span class="post-date" title="2025-06-02 15:33:15">2025/06/02</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/05/31/D%5E3CTF2025/"
           data-tag="CTF,RE,WritesUp,Android"
           data-author="" >
            <span class="post-title" title="D^3CTF2025">D^3CTF2025</span>
            <span class="post-date" title="2025-05-31 16:21:11">2025/05/31</span>
        </a>
        
        
        <a  class="All Unidbgå­¦ä¹  "
           href="/2025/05/28/%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8(%E4%B8%80)/"
           data-tag="Unidbg"
           data-author="" >
            <span class="post-title" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(ä¸€)">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(ä¸€)</span>
            <span class="post-date" title="2025-05-28 16:39:23">2025/05/28</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/05/17/Parloo2025/"
           data-tag="CTF,RE,WritesUp"
           data-author="" >
            <span class="post-title" title="Parloo RE">Parloo RE</span>
            <span class="post-date" title="2025-05-17 09:34:20">2025/05/17</span>
        </a>
        
        
        <a  class="All Android-RE "
           href="/2025/05/07/%E8%AE%B0%E4%B8%80%E6%AC%A1APK%E5%88%86%E6%9E%90/"
           data-tag="RE,WritesUp,Android"
           data-author="" >
            <span class="post-title" title="è®°ä¸€æ¬¡APKåˆ†æ">è®°ä¸€æ¬¡APKåˆ†æ</span>
            <span class="post-date" title="2025-05-07 21:12:00">2025/05/07</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/04/26/%E4%B8%80%E9%81%93%E5%BE%88%E9%80%86%E5%A4%A9%E7%9A%84RC4/"
           data-tag="CTF,RE,WritesUp,æŠ½è±¡"
           data-author="" >
            <span class="post-title" title="æŠ½è±¡RC4">æŠ½è±¡RC4</span>
            <span class="post-date" title="2025-04-26 22:21:19">2025/04/26</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/04/24/%E5%BE%88%E6%9C%89%E6%84%8F%E6%80%9D%E7%9A%84%E4%B8%80%E9%81%93%E9%A2%98/"
           data-tag="CTF,RE,WritesUp"
           data-author="" >
            <span class="post-title" title="å¾ˆæœ‰æ„æ€çš„ä¸€é“é¢˜">å¾ˆæœ‰æ„æ€çš„ä¸€é“é¢˜</span>
            <span class="post-date" title="2025-04-24 21:56:18">2025/04/24</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/04/23/%E4%BA%AC%E9%BA%92CTF2025%20%E7%83%AD%E8%BA%AB%E8%B5%9B/"
           data-tag="CTF,RE,WritesUp,iOS,SIMD"
           data-author="" >
            <span class="post-title" title="äº¬éº’CTF2025çƒ­èº«èµ›">äº¬éº’CTF2025çƒ­èº«èµ›</span>
            <span class="post-date" title="2025-04-23 13:33:59">2025/04/23</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/04/14/TGCTF2025/"
           data-tag="CTF,RE,WritesUp"
           data-author="" >
            <span class="post-title" title="TGCTF2025 RE">TGCTF2025 RE</span>
            <span class="post-date" title="2025-04-14 18:51:29">2025/04/14</span>
        </a>
        
        
        <a  class="All Angrå…¥é—¨ "
           href="/2025/04/14/Angr%E5%85%A5%E9%97%A8/"
           data-tag="ç¬¦å·æ‰§è¡Œ"
           data-author="" >
            <span class="post-title" title="Angrå…¥é—¨">Angrå…¥é—¨</span>
            <span class="post-date" title="2025-04-14 18:50:44">2025/04/14</span>
        </a>
        
        
        <a  class="All Fridaå…¥é—¨ "
           href="/2025/04/14/Frida%E5%85%A5%E9%97%A8/"
           data-tag="Android,Frida"
           data-author="" >
            <span class="post-title" title="Fridaå…¥é—¨">Fridaå…¥é—¨</span>
            <span class="post-date" title="2025-04-14 18:47:37">2025/04/14</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/04/12/TEXSAWCTF%202025/"
           data-tag="CTF,RE,WritesUp"
           data-author="" >
            <span class="post-title" title="TEXSAWCTF 2025">TEXSAWCTF 2025</span>
            <span class="post-date" title="2025-04-12 15:32:31">2025/04/12</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/03/23/NCTF2024/"
           data-tag="CTF,RE,WritesUp,vm,go"
           data-author="" >
            <span class="post-title" title="NCTF2024">NCTF2024</span>
            <span class="post-date" title="2025-03-23 11:58:53">2025/03/23</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/03/18/CISCN%20x%20CCB%20%E5%8D%8A%E5%86%B3%E8%B5%9B%202025%20ISW(%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94)/"
           data-tag="ISW,åº”æ€¥å“åº”,å–è¯"
           data-author="" >
            <span class="post-title" title="CISCN x CCB åŠå†³èµ› 2025 ISW(åº”æ€¥å“åº”)">CISCN x CCB åŠå†³èµ› 2025 ISW(åº”æ€¥å“åº”)</span>
            <span class="post-date" title="2025-03-18 10:24:23">2025/03/18</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/03/11/TPCTF%202025/"
           data-tag="CTF,RE,WritesUp"
           data-author="" >
            <span class="post-title" title="TPCTF 2025">TPCTF 2025</span>
            <span class="post-date" title="2025-03-11 21:41:19">2025/03/11</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/03/06/VishwaCTF2025/"
           data-tag="CTF,RE,WritesUp,Android,Unity"
           data-author="" >
            <span class="post-title" title="VishwaCTF2025">VishwaCTF2025</span>
            <span class="post-date" title="2025-03-06 21:52:51">2025/03/06</span>
        </a>
        
        
        <a  class="All CTF "
           href="/2025/03/03/HGAME%20RE/"
           data-tag="CTF,RE,WritesUp,Android"
           data-author="" >
            <span class="post-title" title="HGAME-RE-WEEK1">HGAME-RE-WEEK1</span>
            <span class="post-date" title="2025-03-03 22:20:33">2025/03/03</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="Toggle full screen shortcut key s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Unidbgå­¦ä¹ ">Unidbgå­¦ä¹ </a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">Unidbg</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2025-08-14 14:42:58'>2025-08-10 10:25</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:19.1k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="Jump to comment area">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%8E%E5%AE%9E%E8%B7%B5%E4%B8%AD%E5%AD%A6%E4%B9%A0unidbg%E4%BD%BF%E7%94%A8-%E5%85%AD"><span class="toc-text">ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80"><span class="toc-text">ä¸€ã€å¼•è¨€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E4%BB%BB%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">äºŒã€ä»»åŠ¡ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">ä¸‰ã€åˆå§‹åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81getEnvironmentInfo"><span class="toc-text">å››ã€getEnvironmentInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81getEnvironmentInfoExtra"><span class="toc-text">äº”ã€getEnvironmentInfoExtra</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81getExtrarnalEquipmentInfo"><span class="toc-text">å…­ã€getExtrarnalEquipmentInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81getHWEquipmentInfo"><span class="toc-text">ä¸ƒã€getHWEquipmentInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81getHWProperty"><span class="toc-text">å…«ã€getHWProperty</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B9%9D%E3%80%81getHWStatus"><span class="toc-text">ä¹ã€getHWStatus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E3%80%81getLocationInfo"><span class="toc-text">åã€getLocationInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81getPlatformInfo"><span class="toc-text">åä¸€ã€getPlatformInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81getUserAction"><span class="toc-text">åäºŒã€getUserAction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E5%B0%BE%E5%A3%B0"><span class="toc-text">åä¸‰ã€å°¾å£°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81%E5%8F%82%E8%80%83"><span class="toc-text">åå››ã€å‚è€ƒ</span></a></li></ol></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨-å…­"><a href="#ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨-å…­" class="headerlink" title="ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)"></a>ä»å®è·µä¸­å­¦ä¹ unidbgä½¿ç”¨(å…­)</h1><h3 id="ä¸€ã€å¼•è¨€"><a href="#ä¸€ã€å¼•è¨€" class="headerlink" title="ä¸€ã€å¼•è¨€"></a>ä¸€ã€å¼•è¨€</h3><p>æœ¬ç¯‡æ ·æœ¬è¯¦è§å‚è€ƒ</p>
<h3 id="äºŒã€ä»»åŠ¡ä»‹ç»"><a href="#äºŒã€ä»»åŠ¡ä»‹ç»" class="headerlink" title="äºŒã€ä»»åŠ¡ä»‹ç»"></a>äºŒã€ä»»åŠ¡ä»‹ç»</h3><p><strong>Jadx</strong> åç¼–è¯‘ APKï¼Œæ‰¾åˆ° <strong>com.meituan.android.common.mtguard.NBridge</strong> ç±»ï¼Œè¿™æ˜¯ <strong>MTGuard å®‰å…¨ SDK</strong> çš„ä¸€ä¸ª Java æ¡¥æ¥å±‚ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå« <strong>SIUACollector</strong> çš„å†…éƒ¨ç±»ï¼Œé‡Œé¢æœ‰ä»¥ä¸‹è¿™äº› Native æ–¹æ³•ã€‚</p>
<pre><code class="language-Java">private native String getEnvironmentInfo();

private native String getEnvironmentInfoExtra();

private native String getExternalEquipmentInfo();

private native String getHWEquipmentInfo();

private native String getHWProperty();

private native String getHWStatus();

private native String getLocationInfo();

private native String getPlatformInfo();

private native String getUserAction();

public native String startCollection();
</code></pre>
<p>æ˜¯ â€œ<strong>å®‰å…¨ä¿¡æ¯ä¸ç”¨æˆ·è¡Œä¸ºé‡‡é›†å™¨</strong>â€ ï¼Œæ”¶é›† <strong>ç¡¬ä»¶ä¿¡æ¯</strong>ã€æ£€æŸ¥ <strong>ç½‘ç»œä¿¡æ¯</strong>ã€è·å– <strong>åº”ç”¨ä¿¡æ¯</strong>ã€<strong>ç”µæ± çŠ¶æ€</strong> ç­‰ã€‚</p>
<p>è¯·åœ¨ Unidbg ä¸­ä¾æ¬¡æ‰§è¡Œè¿™åä¸ªå‡½æ•°ï¼Œæœ¬ç¯‡çš„é‡ç‚¹æ˜¯å·©å›º Unidbg è¡¥ç¯å¢ƒçš„å½¢å¼ï¼Œä»¥åŠå­¦ä¹  Unidbg è¡¥ç¯å¢ƒçš„å†…å®¹ã€‚</p>
<h3 id="ä¸‰ã€åˆå§‹åŒ–"><a href="#ä¸‰ã€åˆå§‹åŒ–" class="headerlink" title="ä¸‰ã€åˆå§‹åŒ–"></a>ä¸‰ã€åˆå§‹åŒ–</h3><p>é¦–å…ˆæ­ä¸€ä¸ªåŸºæœ¬æ¶å­</p>
<pre><code class="language-java">package com.test4;

import com.github.unidbg.AndroidEmulator;
import com.github.unidbg.arm.backend.Unicorn2Factory;
import com.github.unidbg.linux.android.AndroidEmulatorBuilder;
import com.github.unidbg.linux.android.AndroidResolver;
import com.github.unidbg.linux.android.dvm.AbstractJni;
import com.github.unidbg.linux.android.dvm.DalvikModule;
import com.github.unidbg.linux.android.dvm.DvmClass;
import com.github.unidbg.linux.android.dvm.VM;
import com.github.unidbg.memory.Memory;

import java.io.File;

public class TEST4 extends AbstractJni &#123;
    private final AndroidEmulator emulator;
    private final DvmClass SIUACollector;
    private final VM vm;

    public TEST4() &#123;
        emulator = AndroidEmulatorBuilder
                .for32Bit()
                .addBackendFactory(new Unicorn2Factory(true))
                .setProcessName(&quot;com.dianping.v1&quot;)
                .build();
        Memory memory = emulator.getMemory();
        memory.setLibraryResolver(new AndroidResolver(23));
        vm = emulator.createDalvikVM(new File(&quot;E:\\AndroidTools\\unidbg\\unidbg-android\\src\\test\\java\\com\\test4\\dazhongdianping.apk&quot;));
        vm.setJni(this);
        vm.setVerbose(true);
        DalvikModule dm = vm.loadLibrary(&quot;mtguard&quot;, true);
        SIUACollector = vm.resolveClass(&quot;com/meituan/android/common/mtguard/NBridge$SIUACollector&quot;);
        dm.callJNI_OnLoad(emulator);

    &#125;
    
    public static void main(String[] args) &#123;
        TEST4 test4 = new TEST4();
    &#125;
    
&#125;
</code></pre>
<p>å†…éƒ¨ç±»å’Œå¤–éƒ¨ç±»ä¹‹é—´ç”¨è¿‡ <strong>$</strong> åˆ†å‰²ï¼Œè¿™æ˜¯ Java ä¸­å›ºå®šçš„è¡¨ç¤ºæ³•ã€‚</p>
<p>è¿è¡Œçœ‹åˆ°æŠ¥é”™</p>
<pre><code class="language-shell">[10:57:05 459]  INFO [com.github.unidbg.linux.AndroidElfLoader] (AndroidElfLoader:481) - libmtguard.so load dependency libandroid.so failed
[10:57:05 472]  INFO [com.github.unidbg.linux.AndroidElfLoader] (AndroidElfLoader:481) - libmtguard.so load dependency libjnigraphics.so failed
JNIEnv-&gt;FindClass(com/meituan/android/common/mtguard/NBridge) was called from RX@0x1200545d[libmtguard.so]0x545d
JNIEnv-&gt;RegisterNatives(com/meituan/android/common/mtguard/NBridge, RW@0x120d0004[libmtguard.so]0xd0004, 1) was called from RX@0x120054c7[libmtguard.so]0x54c7
RegisterNative(com/meituan/android/common/mtguard/NBridge, main(I[Ljava/lang/Object;)[Ljava/lang/Object;, RX@0x1205c589[libmtguard.so]0x5c589)
JNIEnv-&gt;FindClass(com/meituan/android/common/mtguard/NBridge$SIUACollector) was called from RX@0x12005591[libmtguard.so]0x5591
JNIEnv-&gt;RegisterNatives(com/meituan/android/common/mtguard/NBridge$SIUACollector, RW@0x122d205c, 10) was called from RX@0x120055c7[libmtguard.so]0x55c7
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getHWProperty()Ljava/lang/String;, RX@0x1200a931[libmtguard.so]0xa931)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getEnvironmentInfoExtra()Ljava/lang/String;, RX@0x12007111[libmtguard.so]0x7111)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getEnvironmentInfo()Ljava/lang/String;, RX@0x12006df9[libmtguard.so]0x6df9)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getHWStatus()Ljava/lang/String;, RX@0x1201a86d[libmtguard.so]0x1a86d)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getHWEquipmentInfo()Ljava/lang/String;, RX@0x12028841[libmtguard.so]0x28841)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getExternalEquipmentInfo()Ljava/lang/String;, RX@0x120353f5[libmtguard.so]0x353f5)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getUserAction()Ljava/lang/String;, RX@0x12040159[libmtguard.so]0x40159)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getPlatformInfo()Ljava/lang/String;, RX@0x120464e1[libmtguard.so]0x464e1)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, getLocationInfo()Ljava/lang/String;, RX@0x1204f909[libmtguard.so]0x4f909)
RegisterNative(com/meituan/android/common/mtguard/NBridge$SIUACollector, startCollection()Ljava/lang/String;, RX@0x1205ab41[libmtguard.so]0x5ab41)
</code></pre>
<p>åŠ è½½ libandroid.soã€libjnigraphics.so å¤±è´¥ï¼Œå‰é¢æˆ‘ä»¬æè¿‡å®ƒä¿©çš„è™šæ‹Ÿæ¨¡å—ã€‚</p>
<pre><code class="language-Java">public TEST4() &#123;
        emulator = AndroidEmulatorBuilder
                .for32Bit()
                .addBackendFactory(new Unicorn2Factory(true))
                .setProcessName(&quot;com.dianping.v1&quot;)
                .build();
        Memory memory = emulator.getMemory();
        memory.setLibraryResolver(new AndroidResolver(23));
        vm = emulator.createDalvikVM(new File(&quot;E:\\AndroidTools\\unidbg\\unidbg-android\\src\\test\\java\\com\\test4\\dazhongdianping.apk&quot;));
        vm.setJni(this);
        vm.setVerbose(true);
        
        // ä½¿ç”¨ libandroid.so çš„è™šæ‹Ÿæ¨¡å—
        new AndroidModule(emulator, vm).register(memory);
        // ä½¿ç”¨ libjnigraphics.so çš„è™šæ‹Ÿæ¨¡å—
        new JniGraphics(emulator, vm).register(memory);
        
        DalvikModule dm = vm.loadLibrary(&quot;mtguard&quot;, true);
        SIUACollector = vm.resolveClass(&quot;com/meituan/android/common/mtguard/NBridge$SIUACollector&quot;);
        dm.callJNI_OnLoad(emulator);

    &#125;
</code></pre>
<p>å†æ¬¡è¿è¡Œå°±ä¸ä¼šæŠ¥ä¾èµ–åº“ç¼ºå°‘çš„é”™è¯¯äº†ï¼ŒUnidbg ç›®å‰ä¸€å…±å®ç°æœ‰ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæ¨¡å—ã€‚<br><img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/image-20250810110108107.png" alt="image-20250810110108107"></p>
<h3 id="å››ã€getEnvironmentInfo"><a href="#å››ã€getEnvironmentInfo" class="headerlink" title="å››ã€getEnvironmentInfo"></a>å››ã€getEnvironmentInfo</h3><p>è¿™åä¸ªå‡½æ•°éƒ½æ˜¯å®ä¾‹æ–¹æ³•ï¼Œä¸ºäº†å…äºé‡å¤ <strong>newObject</strong>ï¼Œå°† <strong>SIUACollector</strong> å¤„ç†ä¸º DvmObjectã€‚åŒæ—¶ï¼Œæ·»åŠ å¯¹æ–‡ä»¶è®¿é—®çš„æ‹¦æˆªå¤„ç†ï¼Œæ ·æœ¬å¯èƒ½æœ‰æ–‡ä»¶æ“ä½œã€‚</p>
<pre><code class="language-Java">package com.test4;

import com.github.unidbg.AndroidEmulator;
import com.github.unidbg.Emulator;
import com.github.unidbg.arm.backend.Unicorn2Factory;
import com.github.unidbg.file.FileResult;
import com.github.unidbg.file.IOResolver;
import com.github.unidbg.linux.android.AndroidEmulatorBuilder;
import com.github.unidbg.linux.android.AndroidResolver;
import com.github.unidbg.linux.android.dvm.*;
import com.github.unidbg.memory.Memory;
import com.github.unidbg.virtualmodule.android.AndroidModule;
import com.github.unidbg.virtualmodule.android.JniGraphics;

import java.io.File;

public class TEST4 extends AbstractJni implements IOResolver &#123;
    private final AndroidEmulator emulator;
    private final DvmObject&lt;?&gt; SIUACollector;
    private final VM vm;

    public TEST4() &#123;
        emulator = AndroidEmulatorBuilder
                .for32Bit()
                .addBackendFactory(new Unicorn2Factory(true))
                .setProcessName(&quot;com.dianping.v1&quot;)
                .build();
        Memory memory = emulator.getMemory();
        memory.setLibraryResolver(new AndroidResolver(23));
        vm = emulator.createDalvikVM(new File(&quot;E:\\AndroidTools\\unidbg\\unidbg-android\\src\\test\\java\\com\\test4\\dazhongdianping.apk&quot;));
        vm.setJni(this);
        vm.setVerbose(true);

        emulator.getSyscallHandler().addIOResolver(this);

        // ä½¿ç”¨ libandroid.so çš„è™šæ‹Ÿæ¨¡å—
        new AndroidModule(emulator, vm).register(memory);
        // ä½¿ç”¨ libjnigraphics.so çš„è™šæ‹Ÿæ¨¡å—
        new JniGraphics(emulator, vm).register(memory);

        DalvikModule dm = vm.loadLibrary(&quot;mtguard&quot;, true);
        SIUACollector = vm.resolveClass(&quot;com/meituan/android/common/mtguard/NBridge$SIUACollector&quot;).newObject(null);
        dm.callJNI_OnLoad(emulator);

    &#125;

    @Override
    public FileResult resolve(Emulator emulator, String pathname, int oflags) &#123;
        System.out.println(&quot;lilac open: &quot; + pathname);
        return null;
    &#125;

    public static void main(String[] args) &#123;
        TEST4 test4 = new TEST4();
        System.out.println(&quot;[*] getEnvironmentInfo:&quot; + test4.getEnvironmentInfo());
    &#125;


&#125;
</code></pre>
<p>å‘èµ·å¯¹ getEnvironmentInfo çš„è°ƒç”¨</p>
<pre><code class="language-Java">    public static void main(String[] args) &#123;
        TEST4 test4 = new TEST4();
        System.out.println(&quot;[*] getEnvironmentInfo:&quot; + test4.getEnvironmentInfo());
    &#125;


    public String getEnvironmentInfo() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getEnvironmentInfo()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;
</code></pre>
<p>è¿è¡Œå‘ç°ç›´æ¥å¾—å‡ºäº†ç»“æœï¼Œæ— éœ€è¡¥ç¯å¢ƒã€‚</p>
<pre><code class="language-shell">JNIEnv-&gt;NewStringUTF(&quot;0|0|0|-|0|&quot;) was called from RX@0x12006f5f[libmtguard.so]0x6f5f
JNIEnv-&gt;NewStringUTF(&quot;0|0|0|-|0|&quot;) was called from RX@0x12006ef7[libmtguard.so]0x6ef7
[*] getEnvironmentInfo:0|0|0|-|0|
</code></pre>
<h3 id="äº”ã€getEnvironmentInfoExtra"><a href="#äº”ã€getEnvironmentInfoExtra" class="headerlink" title="äº”ã€getEnvironmentInfoExtra"></a>äº”ã€getEnvironmentInfoExtra</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">    public static void main(String[] args) &#123;
        TEST4 test4 = new TEST4();
        System.out.println(&quot;[*] getEnvironmentInfo:&quot; + test4.getEnvironmentInfo());
        System.out.println(&quot;[*] getEvironmentInfoExtra:&quot; + test4.getEvironmentInfoExtra());
    &#125;


    public String getEnvironmentInfo() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getEnvironmentInfo()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;
    public String getEvironmentInfoExtra() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getEnvironmentInfoExtra()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;
</code></pre>
<p>è¿è¡Œå‘ç°æŠ¥é”™ï¼Œéœ€è¦å¼€å§‹è¡¥ç¯å¢ƒäº†</p>
<p><img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/image-20250810113618928.png" alt="image-20250810113618928"></p>
<p>åˆ†é…ä¸€ä¸ª <strong>StringBuilder</strong> å¯¹è±¡ã€‚å¯¹ <strong>allocObject</strong> è¿™ä¸ª JNI è°ƒç”¨æ„Ÿåˆ°é™Œç”Ÿï¼Œä¸Šç½‘æŸ¥äº†ä¸‹ï¼Œå®ƒç”¨äºåˆ†é…å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ AbstractJNI ä¸­å¾—åˆ°å‚è€ƒã€‚</p>
<pre><code class="language-java">    @Override
    public DvmObject&lt;?&gt; allocObject(BaseVM vm, DvmClass dvmClass, String signature) &#123;
        if (&quot;java/util/HashMap-&gt;allocObject&quot;.equals(signature)) &#123;
            return dvmClass.newObject(new HashMap&lt;&gt;());
        &#125;

        throw new UnsupportedOperationException(signature);
    &#125;
</code></pre>
<p>åŒç†å¤„ç†</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; allocObject(BaseVM vm, DvmClass dvmClass, String signature) &#123;
        switch (signature) &#123;
            case &quot;java/lang/StringBuilder-&gt;allocObject&quot;: &#123;
                return dvmClass.newObject(new StringBuilder());
            &#125;
        &#125;
        return super.allocObject(vm, dvmClass, signature);
    &#125;
</code></pre>
<p>ä½†æ˜¯æŒ‰ç…§å‰æ–‡æ‰€è®¨è®ºçš„è§„èŒƒï¼ŒStringBuilder æ˜¯ JDK ä¸­çš„ç±»åº“ï¼Œä½¿ç”¨ <strong>ProxyDvmObject.createObject</strong> æ›´å¥½ã€‚</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; allocObject(BaseVM vm, DvmClass dvmClass, String signature) &#123;
        switch (signature) &#123;
            case &quot;java/lang/StringBuilder-&gt;allocObject&quot;: &#123;
                return ProxyDvmObject.createObject(vm, new StringBuilder());
            &#125;
        &#125;
        return super.allocObject(vm, dvmClass, signature);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼ŒæŠ¥é”™<br><img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/image-20250810114335805.png" alt="image-20250810114335805"></p>
<p>åˆšåˆ†é…çš„ <strong>StringBuilder</strong> å¯¹è±¡ï¼Œè¿™é‡Œåœ¨åšåˆå§‹åŒ–ï¼Œä»€ä¹ˆéƒ½ä¸å¿…å¤„ç†ã€‚</p>
<pre><code class="language-Java">    @Override
    public void callVoidMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;java/lang/StringBuilder-&gt;&lt;init&gt;()V&quot;: &#123;
                return;
            &#125;
        &#125;
        super.callVoidMethodV(vm, dvmObject, signature, vaList);
    &#125;
</code></pre>
<p>å…¶å® Unidbg åœ¨ <strong>allocObject</strong> è¿™ä¸ª JNI æ–¹æ³•ä¸Šçš„å¤„ç†é€»è¾‘ä¸å¤ªå¥½ï¼Œè¿™é‡Œè¿˜æ²¡ä½“ç°å‡ºæ¥ï¼Œåé¢å†è¯´ã€‚</p>
<p>ç»§ç»­è¿è¡Œå’ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getEnvironmentInfo()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯æˆ‘ä»¬ä¸Šä¸€ä¸ªè¡¥çš„ <strong>getEnvironmentInof</strong>ï¼Œä½ å¯èƒ½è§‰å¾—åƒä¸‹é¢è¿™æ ·å¤„ç†å°±å¥½äº†</p>
<pre><code class="language-Java">@Override
public DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
    switch (signature)&#123;
        case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getEnvironmentInfo()Ljava/lang/String;&quot;:&#123;
            return new StringObject(vm, getEnvironmentInfo());
        &#125;
    &#125;
    return super.callObjectMethodV(vm, dvmObject, signature, vaList);
&#125;
</code></pre>
<p>ä½†äº‹å®ä¸Šè¿™æ˜¯è¡Œä¸é€šçš„ï¼ŒNative æ–¹æ³•é‡Œè°ƒç”¨å¦ä¸€ä¸ª Native æ–¹æ³•ï¼Œè¿™å±äºåµŒå¥—è°ƒç”¨ï¼ŒUnidbg æš‚ä¸æ”¯æŒè¿™ä¹ˆåšï¼Œæ‰€ä»¥è¿™é‡Œæ‰‹åŠ¨å¡«å…¥å…ˆå‰å¾—åˆ°çš„ç»“æœï¼Œ</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getEnvironmentInfo()Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;0|0|0|-|0|&quot;);
            &#125;
        &#125;
        return super.callObjectMethodV(vm, dvmObject, signature, vaList);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œå’ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/StringBuilder-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:97)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>æŒ‰ç…§è¯­ä¹‰è¡¥ append æ–¹æ³•</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; callObjectMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getEnvironmentInfo()Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;0|0|0|-|0|&quot;);
            &#125;
            case &quot;java/lang/StringBuilder-&gt;append(Ljava/lang/String;)Ljava/lang/StringBuilder;&quot;: &#123;
                String str = vaList.getObjectArg(0).getValue().toString();
                return ProxyDvmObject.createObject(vm, ((StringBuilder) dvmObject.getValue()).append(str));
            &#125;
        &#125;
        return super.callObjectMethodV(vm, dvmObject, signature, vaList);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œå’ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isVPN()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:101)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ç”¨äºæ£€æµ‹ VPNï¼Œ<strong>Jadx</strong> ä¸­çœ‹çœ‹å®ƒçš„å®ç°ï¼Œæ ·æœ¬é‡‡ç”¨äº†è‡ªå®¶çš„çƒ­ä¿®å¤æŠ€æœ¯<img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/favicon.ico" alt="img"><a target="_blank" rel="noopener" href="https://tech.meituan.com/2016/09/14/android-robust.html">Androidçƒ­æ›´æ–°æ–¹æ¡ˆ Robust</a>ï¼Œä»£ç çœ‹èµ·æ¥ä¸å¤ªèˆ’æœã€‚</p>
<pre><code class="language-JAVA">        private String isVPN() &#123;
            Object[] objArr = new Object[0];
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            return PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;b6362e66d9b10061bc6c2e73cafc0cc8&quot;, RobustBitConfig.DEFAULT_VALUE) ? (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;b6362e66d9b10061bc6c2e73cafc0cc8&quot;) : EnvInfoWorker.isVPN();
        &#125;
</code></pre>
<p>æœ«å°¾çš„ <strong>EnvInfoWorker.isVPN()</strong> æ˜¯å…¶å®ç°å‡½æ•°ã€‚</p>
<pre><code class="language-Java">public static synchronized String isVPN() &#123;
    synchronized (EnvInfoWorker.class) &#123;
        Object[] objArr = new Object[0];
        ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
        if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;b5d91cd54a8036812d448963f1a976c9&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
            return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;b5d91cd54a8036812d448963f1a976c9&quot;);
        &#125;
        Enumeration&lt;NetworkInterface&gt; networkInterfaces = NetworkInterface.getNetworkInterfaces();
        if (networkInterfaces == null) &#123;
            return &quot;0&quot;;
        &#125;
        Iterator it = Collections.list(networkInterfaces).iterator();
        while (it.hasNext()) &#123;
            NetworkInterface networkInterface = (NetworkInterface) it.next();
            if (networkInterface.isUp()) &#123;
                if (networkInterface.getInterfaceAddresses().size() != 0 &amp;&amp; &quot;tun0&quot;.equals(networkInterface.getName())) &#123;
                    return &quot;1&quot;;
                &#125;
            &#125;
            if (&quot;ppp0&quot;.equals(networkInterface.getName())) &#123;
                return &quot;1&quot;;
            &#125;
        &#125;
        return &quot;0&quot;;
    &#125;
&#125;
</code></pre>
<p>é—®äº†ä¸‹ chatGPTï¼Œå½“å®¢æˆ·ç«¯è¿è¡Œ <strong>VPN</strong> æ—¶ï¼Œä¼šåˆ›å»º <strong>tun0</strong> æˆ– <strong>ppp0</strong> èŠ‚ç‚¹ï¼Œæ‰€ä»¥å‡ºç°å¸¦æœ‰æ˜æ˜¾ç‰¹å¾çš„ç½‘ç»œæ¥å£åç§°ï¼Œå°±å¯ä»¥è®¤å®šæ˜¯ä½¿ç”¨äº† <strong>VPN</strong> åè®®è¿›è¡Œé€šä¿¡ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-Java">private void isDeviceInVPN() &#123;
    try &#123;
        Enumeration&lt;NetworkInterface&gt; networkInterfaces = NetworkInterface.getNetworkInterfaces();
        while (networkInterfaces.hasMoreElements()) &#123;
            String name = networkInterfaces.nextElement().getName();
            if (name.equals(&quot;tun0&quot;) || name.equals(&quot;ppp0&quot;)) &#123;
                stop();
            &#125;
        &#125;
    &#125; catch (SocketException e) &#123;
        e.printStackTrace();
    &#125;
&#125;
</code></pre>
<p>å’Œæ ·æœ¬æ­¤å¤„è¿›è¡Œå¯¹ç…§ï¼Œå¯ä»¥å‘ç°è¿”å› 0 æ˜¯æ²¡æ£€æµ‹åˆ°ï¼Œè¿”å› 1 å°±æ˜¯æ£€æµ‹åˆ°äº†ã€‚</p>
<p>è¯»è€…å¯èƒ½æƒ³å›¾æ–¹ä¾¿ï¼Œä½¿ç”¨ Frida åœ¨çœŸå®è®¾å¤‡ä¸Š Hook æˆ– Call è¿™ä¸ªå‡½æ•°ï¼Œç›´æ¥è·å¾—ç»“æœã€‚ä½†è¿™ä¹ˆåšæœ‰å¼Šç«¯ï¼Œå¦‚æœä½ çœŸæœºä½¿ç”¨äº† VPNï¼Œé‚£ä¹ˆå°±ä¼šè¿”å› 1.</p>
<pre><code class="language-Java">            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isVPN()Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;0&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;mContext:Landroid/content/Context;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:171)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:141)
	at com.github.unidbg.linux.android.dvm.DvmField.getObjectField(DvmField.java:126)
	at com.github.unidbg.linux.android.dvm.DalvikVM$92.handle(DalvikVM.java:1408)
</code></pre>
<p>Context æ˜¯ä¸€ä¸ªç›¸å½“ç‰¹æ®Šçš„å¯¹è±¡ï¼Œå‰é¢é‡åˆ°è¿‡å®ƒï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆç”¨æœ€æœ´ç´ çš„æ–¹æ³•å»å¤„ç†å®ƒâ€”â€”<strong>resolveClass</strong> å ä½ã€‚</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; getObjectField(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;mContext:Landroid/content/Context;&quot;: &#123;
                return vm.resolveClass(&quot;android/content/Context&quot;).newObject(null);
            &#125;
        &#125;
        return super.getObjectField(vm, dvmObject, signature);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;brightness(Landroid/content/Context;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:104)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>å›åˆ° <strong>Jadx</strong> ä¸­æ‰¾åˆ°å¯¹åº”å‡½æ•°</p>
<pre><code class="language-Java">        private String brightness(Context context) &#123;
            Object[] objArr = &#123;context&#125;;
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            return PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;e3c10305f195ff2aac2fd606a6235fb2&quot;, RobustBitConfig.DEFAULT_VALUE) ? (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;e3c10305f195ff2aac2fd606a6235fb2&quot;) : DeviceInfoWorker.brightness(context);
        &#125;
</code></pre>
<pre><code class="language-Java">    public static String brightness(Context context) &#123;
        Object[] objArr = &#123;context&#125;;
        ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
        if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;af80a1c664fdf95866b7caabf24ab495&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
            return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;af80a1c664fdf95866b7caabf24ab495&quot;);
        &#125;
        try &#123;
            return StringUtils.toString(Settings.System.getInt(context.getContentResolver(), &quot;screen_brightness&quot;) / 255.0f);
        &#125; catch (Throwable th) &#123;
            c.a(th);
            return StringUtils.toString(0.0f);
        &#125;
    &#125;
</code></pre>
<p>ä»å‡½æ•°åå’ŒåŸºæœ¬é€»è¾‘ä¸Šçœ‹ï¼Œä¼¼ä¹æ˜¯è·å–å±å¹•äº®åº¦ï¼ŒGoogle æœç´¢ <strong>getContentResolver</strong> + <strong>screen_brightness</strong></p>
<p>ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä»£ç </p>
<pre><code class="language-Java">/**
 * è·å–ç³»ç»Ÿé»˜è®¤å±å¹•äº®åº¦å€¼ å±å¹•äº®åº¦å€¼èŒƒå›´ï¼ˆ0-255ï¼‰
 * **/
private int getScreenBrightness(Context context) &#123;
    ContentResolver contentResolver = context.getContentResolver();
    int defVal = 0;
    return Settings.System.getInt(contentResolver,
            Settings.System.SCREEN_BRIGHTNESS, defVal);
&#125;
</code></pre>
<p>æ ·æœ¬ä¸­è¿”å›çš„æ˜¯ 0 - 1 ä¹‹é—´çš„ä¸€ä¸ªæ•°ï¼Œç„¶åè½¬å­—ç¬¦ä¸²ï¼Œæˆ‘è¿™é‡Œé€‰æ‹© 0.8</p>
<pre><code class="language-Java">            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;brightness(Landroid/content/Context;)Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;0.8&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-Java">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;systemVolume(Landroid/content/Context;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:107)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>ä¹Ÿè¿˜æ˜¯ä¸€æ ·å›åˆ° <strong>Jadx</strong> ä¸­æŸ¥çœ‹æ ·æœ¬çš„ä¼ªä»£ç ï¼Œè¿™é‡Œæ˜¯è·å–éŸ³é‡</p>
<pre><code class="language-Java">        private String systemVolume(Context context) &#123;
            Object[] objArr = &#123;context&#125;;
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            return PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;25bed8eb997e1fc4de8fea79d40481a3&quot;, RobustBitConfig.DEFAULT_VALUE) ? (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;25bed8eb997e1fc4de8fea79d40481a3&quot;) : DeviceInfoWorker.systemVolume(context);
        &#125;
</code></pre>
<pre><code class="language-Java">    public static String systemVolume(Context context) &#123;
        Object[] objArr = &#123;context&#125;;
        ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
        if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;94db8653238995da6df94fea33fbbf79&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
            return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;94db8653238995da6df94fea33fbbf79&quot;);
        &#125;
        try &#123;
            AudioManager audioManager = (AudioManager) context.getSystemService(&quot;audio&quot;);
            return StringUtils.toString((audioManager.getStreamVolume(1) * 100) / audioManager.getStreamMaxVolume(1));
        &#125; catch (Throwable th) &#123;
            c.a(th);
            return &quot;&quot;;
        &#125;
    &#125;
</code></pre>
<p>ç›´æ¥è¿”å› 0ï¼Œä¹Ÿå°±æ˜¯é™éŸ³</p>
<pre><code class="language-Java">            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;systemVolume(Landroid/content/Context;)Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;0&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isAccessibilityEnable()Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callBooleanMethodA(DvmMethod.java:124)
</code></pre>
<p>è¿™æ¬¡æ˜¯ <strong>isAccessibilityEnable</strong> ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æ— éšœç¢æœåŠ¡ã€‚æ— éšœç¢æœåŠ¡çš„æœ¬æ„æ˜¯å¸®åŠ©æ®‹ç–¾äººå£«ã€è€äººã€å°å­©ç­‰ï¼Œä½†é•¿ä¹…ä»¥æ¥è¢«ç”¨äºè‡ªåŠ¨åŒ–æ§åˆ¶ï¼Œæ¯”å¦‚æŠ¢å•ï¼Œå› æ­¤æ— éšœç¢æœåŠ¡æ˜¯é£é™©æ£€æµ‹ã€ç¯å¢ƒæ£€æµ‹ã€åæ¬ºè¯ˆæ£€æµ‹çš„é‡è¦ä¸€ç¯ã€‚</p>
<pre><code class="language-Java">    @Override
    public boolean callBooleanMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isAccessibilityEnable()Z&quot;: &#123;
                return false;
            &#125;
        &#125;
        return super.callBooleanMethodV(vm, dvmObject, signature, vaList);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;valueOf(I)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:504)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:438)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callStaticObjectMethodA(DvmMethod.java:64)
</code></pre>
<p>è¿™ä¸ªæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä¹Ÿæ˜¯ç›´æ¥å‚ç…§è¯­ä¹‰ç›´æ¥è¡¥å°±å¥½äº†</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; callStaticObjectMethodV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;java/lang/String-&gt;valueOf(I)Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, String.valueOf(vaList.getIntArg(0)));
            &#125;
        &#125;
        return super.callStaticObjectMethodV(vm, dvmClass, signature, vaList);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;uiAutomatorClickCount()I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callIntMethodA(DvmMethod.java:134)
</code></pre>
<p><strong>uiAutomatorClickCount</strong> çš„å…·ä½“å®ç°å¦‚ä¸‹</p>
<pre><code class="language-Java">    public static int uiAutomatorClickCount() &#123;
        Object[] objArr = new Object[0];
        ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
        if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;7e55945fa3fd311f57ffc508c34fa364&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
            return ((Integer) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;7e55945fa3fd311f57ffc508c34fa364&quot;)).intValue();
        &#125;
        if (verify()) &#123;
            return mAdapter.uiAutomatorCount();
        &#125;
        return 0;
    &#125;
</code></pre>
<p>è¿™ä¸ªç±»çš„ä¸»è¦ä½œç”¨æ˜¯è¿”å› <strong>UI Automator ç‚¹å‡»æ¬¡æ•°</strong>ï¼Œå¯ä»¥Frida Hook çœ‹ä¸€ä¸‹</p>
<pre><code class="language-js">Java.perform(function() &#123;
    let SIUACollector = Java.use(&quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;);
    SIUACollector[&quot;uiAutomatorClickCount&quot;].implementation = function () &#123;
        console.log(&#39;uiAutomatorClickCount is called&#39;);
        let ret = this.uiAutomatorClickCount();
        console.log(&#39;uiAutomatorClickCount ret value is &#39; + ret);
        return ret;
    &#125;;
&#125;)
</code></pre>
<p>ç»“æœå¦‚ä¸‹</p>
<pre><code class="language-shell">uiAutomatorClickCount ret value is 0
</code></pre>
<p>é‚£ä¹ˆå°±å¯ä»¥è¡¥ç¯å¢ƒäº†</p>
<pre><code class="language-Java">    @Override
    public int callIntMethodV(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature, VaList vaList) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;uiAutomatorClickCount()I&quot;: &#123;
                return 0;
            &#125;
        &#125;
        return super.callIntMethodV(vm, dvmObject, signature, vaList);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/StringBuilder-&gt;toString()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:110)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/StringBuilder-&gt;toString()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, dvmObject.getValue().toString());
&#125;
</code></pre>
<p>è¿è¡Œï¼Œç»ˆäºè·‘é€šäº†</p>
<pre><code class="language-shell">[*] getEvironmentInfoExtra:0|0|0|-|0|0|0.8|0|0|0|
</code></pre>
<p>è¿™ä¸ªç»“æœå’Œä¸Šä¸€ä¸ªç»“æœä¸€æ ·ï¼Œæœ‰å¾ˆå¤š 0ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯æ”¶é›†ä¿¡æ¯ï¼Œç„¶åä½¿ç”¨ <strong>|</strong> ä½œä¸ºåˆ†å‰²å¹¶æ‹¼æ¥èµ·æ¥ã€‚</p>
<h3 id="å…­ã€getExtrarnalEquipmentInfo"><a href="#å…­ã€getExtrarnalEquipmentInfo" class="headerlink" title="å…­ã€getExtrarnalEquipmentInfo"></a>å…­ã€getExtrarnalEquipmentInfo</h3><p>æ–°å¢å¯¹å®ƒçš„call</p>
<pre><code class="language-Java">    public static void main(String[] args) &#123;
        TEST4 test4 = new TEST4();
        System.out.println(&quot;[*] getEnvironmentInfo:&quot; + test4.getEnvironmentInfo());
        System.out.println(&quot;[*] getEvironmentInfoExtra:&quot; + test4.getEnvironmentInfoExtra());
        System.out.println(&quot;[*] getExtrernalEquipmentInfo:&quot; + test4.getExternalEquipmentInfo());
    &#125;


    public String getEnvironmentInfo() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getEnvironmentInfo()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;
    public String getEnvironmentInfoExtra() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getEnvironmentInfoExtra()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;

    public String getExternalEquipmentInfo() &#123;
        String result = SIUACollector.callJniMethodObject(emulator, &quot;getExternalEquipmentInfo()Ljava/lang/String;&quot;).getValue().toString();
        return result;
    &#125;
</code></pre>
<p>è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/Context-&gt;getApplicationContext()Landroid/content/Context;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:210)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>ç®€å•å ä½</p>
<pre><code class="language-Java">case &quot;android/content/Context-&gt;getApplicationContext()Landroid/content/Context;&quot;:&#123;
    return vm.resolveClass(&quot;android/content/Context&quot;).newObject(null);
&#125;
</code></pre>
<p>è¿è¡Œï¼Œç»§ç»­æŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/Context-&gt;getSystemService(Ljava/lang/String;)Ljava/lang/Object;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:210)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>ç³»ç»ŸæœåŠ¡æ˜¯ Android æ‰€æä¾›çš„ä¸€é¡¹é‡è¦æœåŠ¡ï¼Œåœ¨ JNI è¡¥ç¯å¢ƒä¸­å‡ºç°é¢‘ç‡ç›¸å½“é«˜ï¼ŒUnidbg å¯¹å®ƒåšäº†ä¸“é—¨å¤„ç†ï¼Œå¯ä»¥å‚è€ƒ AbstractJniï¼Œå…¶ä¸­æœ‰å¦‚ä¸‹ç‰‡æ®µ</p>
<pre><code class="language-Java">            case &quot;android/app/Application-&gt;getSystemService(Ljava/lang/String;)Ljava/lang/Object;&quot;: &#123;
                StringObject serviceName = vaList.getObjectArg(0);
                assert serviceName != null;
                return new SystemService(vm, serviceName.getValue());
            &#125;
</code></pre>
<p>æŠ„ä¸€ä¸‹</p>
<pre><code class="language-Java">case &quot;android/content/Context-&gt;getSystemService(Ljava/lang/String;)Ljava/lang/Object;&quot;:&#123;
    StringObject serviceName = vaList.getObjectArg(0);
    assert serviceName != null;
    return new SystemService(vm, serviceName.getValue());
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isPermissionGranted(Ljava/lang/String;Landroid/content/Context;)Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:230)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callBooleanMethodA(DvmMethod.java:124)
</code></pre>
<p>isPermissionGranted å…·ä½“ä»€ä¹ˆä½œç”¨ï¼Ÿæ ¹æ®å‡½æ•°åã€å‡½æ•°å®ç°å¯ä»¥çœ‹å‡ºï¼Œå°±æ˜¯å¤§è‡´ç”¨æ¥æ£€æµ‹ App æ˜¯å¦æœ‰æŸé¡¹æƒé™ã€‚</p>
<pre><code class="language-Java">        private boolean isPermissionGranted(String str, Context context) &#123;
            Object[] objArr = &#123;str, context&#125;;
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            return PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;a0fa204a6b6694d5ab23ad161583721d&quot;, RobustBitConfig.DEFAULT_VALUE) ? ((Boolean) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;a0fa204a6b6694d5ab23ad161583721d&quot;)).booleanValue() : Permissions.isPermissionGranted(str, context);
        &#125;
</code></pre>
<pre><code class="language-Java">    public static boolean isPermissionGranted(String str, Context context) &#123;
        Object[] objArr = &#123;str, context&#125;;
        ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
        if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;44db3326d9c0bbe25993cff8771e9a68&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
            return ((Boolean) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;44db3326d9c0bbe25993cff8771e9a68&quot;)).booleanValue();
        &#125;
        try &#123;
            return Build.VERSION.SDK_INT &gt;= 23 ? context.getApplicationContext().getApplicationInfo().targetSdkVersion &gt;= 23 ? context.checkSelfPermission(str) == 0 : PermissionChecker.a(context, str) == 0 : PermissionChecker.a(context, str) == 0;
        &#125; catch (Throwable th) &#123;
            c.a(th);
            DFPLog.error(th);
            return false;
        &#125;
    &#125;
</code></pre>
<p>æ‰“å°ä¸€ä¸‹å½“å‰è°ƒç”¨çš„å‚æ•°ã€‚</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isPermissionGranted(Ljava/lang/String;Landroid/content/Context;)Z&quot;:&#123;
    String permissionName = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;[!] check permission:&quot;+permissionName);
&#125;
</code></pre>
<p>è¿è¡ŒæŸ¥çœ‹è¾“å‡º</p>
<pre><code>[!] check permission: android.permission.READ_PHONE_STATE
</code></pre>
<p>è¿™ä¸ªæƒé™å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯ â€œå…è®¸è®¿é—®ç”µè¯çŠ¶æ€æƒé™â€ï¼Œç›´æ¥è¿”å› True</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isPermissionGranted(Ljava/lang/String;Landroid/content/Context;)Z&quot;:&#123;
    String permissionName = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;check permission:&quot;+permissionName);
    if(permissionName.equals(&quot;android.permission.READ_PHONE_STATE&quot;))&#123;
        return true;
    &#125;else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build$VERSION-&gt;SDK_INT:I
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticIntField(AbstractJni.java:136)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticIntField(AbstractJni.java:128)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticIntField(DvmField.java:121)
	at com.github.unidbg.linux.android.dvm.DalvikVM$147.handle(DalvikVM.java:2358)
</code></pre>
<p>è¿™é‡Œæ˜¯åœ¨è·å– SDK çš„ç‰ˆæœ¬ï¼Œç›´æ¥è¿”å›ç›®å‰å¸¸è§çš„ Android 15ï¼Œå³ 35</p>
<pre><code class="language-Java">    @Override
    public int getStaticIntField(BaseVM vm, DvmClass dvmClass, String signature) &#123;
        switch (signature) &#123;
            case &quot;android/os/Build$VERSION-&gt;SDK_INT:I&quot;: &#123;
                return 35;
            &#125;
        &#125;
        return super.getStaticIntField(vm, dvmClass, signature);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;checkBuildAttribute(Ljava/lang/String;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:208)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>å…ˆæ‰“å°ä¸€ä¸‹å‚æ•°ï¼Œçœ‹çœ‹æ˜¯å•¥</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;checkBuildAttribute(Ljava/lang/String;)Ljava/lang/String;&quot;: &#123;
                String arg = vaList.getObjectArg(0).getValue().toString();
                System.out.println(&quot;[!] checkBuildAttribute: &quot; + arg);
            &#125;
</code></pre>
<p>è¿è¡Œï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°ä¸çŸ¥é“æ˜¯å•¥</p>
<pre><code class="language-shell">[!] checkBuildAttribute: -
</code></pre>
<p>æ‰€ä»¥è¿˜æ˜¯ <strong>Jadx</strong> çœ‹çœ‹ä¼ªä»£ç å§</p>
<pre><code class="language-Java">        private String checkBuildAttribute(String str) &#123;
            Object[] objArr = &#123;str&#125;;
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            return PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;3b097946787cf593049f918e4d2f8a4e&quot;, RobustBitConfig.DEFAULT_VALUE) ? (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;3b097946787cf593049f918e4d2f8a4e&quot;) : (TextUtils.isEmpty(str) || str.equalsIgnoreCase(&quot;unknown&quot;)) ? CommonConstant.Symbol.MINUS : str;
        &#125;
</code></pre>
<p>å‰é¢å°±æ˜¯å¸¸è§„çš„çƒ­ä¿®å¤åˆ¤æ–­ï¼Œåé¢å°±æ˜¯åšç®€å•çš„å­—ç¬¦ä¸²æ ¡éªŒï¼Œè‹¥å­—ç¬¦ä¸²ä¸ºç©ºæˆ–æ˜¯ <code>&quot;unknown&quot;</code>ï¼Œè¿”å› <code>&quot;-&quot;</code>ï¼›å¦åˆ™è¿”å›å­—ç¬¦ä¸²æœ¬èº«ã€‚</p>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;checkBuildAttribute(Ljava/lang/String;)Ljava/lang/String;&quot;:&#123;
    String arg = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;checkBuildAttribute:&quot;+arg);
    return new StringObject(vm, arg.isEmpty() || arg.equalsIgnoreCase(&quot;unknown&quot;) ? &quot;-&quot; : arg);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/view/WindowManager-&gt;getDefaultDisplay()Landroid/view/Display;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:213)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ª Android å¯¹è±¡ï¼ŒæŒ‰ç…§å‰é¢æ‰€è¯´çš„è¡¥ç¯å¢ƒåŸåˆ™ç›´æ¥å¤„ç†ã€‚</p>
<pre><code class="language-Java">case &quot;android/view/WindowManager-&gt;getDefaultDisplay()Landroid/view/Display;&quot;:&#123;
    return vm.resolveClass(&quot;android/view/Display&quot;).newObject(null);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/view/Display-&gt;getHeight()I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:273)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callIntMethodA(DvmMethod.java:134)
</code></pre>
<p>åˆæ˜¯ Android FrameWork å±‚çš„ APIï¼Œæ‹·æ‰“äº†ä¸‹ chatGPTï¼Œå®ƒå’Œ <strong>getWidth</strong></p>
<p>ä¸€èµ·ç”¨äºè·å–å±å¹•çš„å®½é«˜ã€‚å¯¹äºè¿™ç±»åŸºæœ¬è®¾å¤‡ä¿¡æ¯ï¼Œå®Œå…¨å¯ä»¥é€šè¿‡ ADB è·å–ã€‚</p>
<pre><code class="language-shell">â””â”€Î” adb shell wm size
Physical size: 1080x2400
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/view/Display-&gt;getHeight()I&quot;:&#123;
    return 2400;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/StringBuilder-&gt;append(I)Ljava/lang/StringBuilder;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:416)
	at com.dianping.NBridge.callObjectMethodV(NBridge.java:139)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">            case &quot;java/lang/StringBuilder-&gt;append(I)Ljava/lang/StringBuilder;&quot;: &#123;
                int value = vaList.getIntArg(0); // ç›´æ¥å– int
                ((StringBuilder) dvmObject.getValue()).append(value); // è‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²æ‹¼æ¥
                return dvmObject; // append è¿”å› this
            &#125;
</code></pre>
<p>ç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/StringBuilder-&gt;append(C)Ljava/lang/StringBuilder;&quot;:&#123;
    return ProxyDvmObject.createObject(vm, ((StringBuilder) dvmObject.getValue()).append((char)vaList.getIntArg(0)));
&#125;
</code></pre>
<p>é‡åˆ°æ–°æŠ¥é”™ï¼Œåˆšåˆšè¡¥è¿‡é«˜ï¼Œç°åœ¨è¡¥çš„æ˜¯å®½</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/view/Display-&gt;getWidth()I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:279)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
</code></pre>
<p>ä¾æ—§æ˜¯æ ¹æ®ä¸Šé¢ adb è·å–çš„å€¼è¿›è¡Œè¡¥</p>
<pre><code class="language-Java">case &quot;android/view/Display-&gt;getWidth()I&quot;:&#123;
    return 1080;
&#125;
</code></pre>
<p>è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getTotalInternalMemorySize()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:219)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p><strong>getTotalInternalMemorySize</strong> è¿™ä¸ªå‡½æ•°åå°±å¾ˆæ¸…æ™°ç›´ç™½ï¼Œå†çœ‹çœ‹ä»£ç é€»è¾‘éªŒè¯ä¸€ä¸‹</p>
<pre><code class="language-Java">        private String getTotalInternalMemorySize() &#123;
            Object[] objArr = new Object[0];
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;838e88ccfd19d138e498f2d967b7d987&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
                return (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;838e88ccfd19d138e498f2d967b7d987&quot;);
            &#125;
            StatFs statFs = new StatFs(Environment.getDataDirectory().getPath());
            return fileSize(statFs.getBlockCount() * statFs.getBlockSize());
        &#125;
</code></pre>
<p>è¿™ä¸ªé€»è¾‘å°±å¾ˆç®€å•ï¼Œ<strong>Environment.getDataDirectory()</strong> å°±æ˜¯ data æ–‡ä»¶å¤¹ï¼Œå®ƒæ˜¯å­˜å‚¨çš„æ ¹ç›®å½•ã€‚<strong>StatFs</strong> åº•å±‚å¯¹åº”äº stat ç»“æ„ä½“</p>
<pre><code class="language-c++">struct stat &#123;
    dev_t     st_dev;     /* ID of device containing file */
    ino_t     st_ino;     /* inode number */
    mode_t    st_mode;    /* protection */
    nlink_t   st_nlink;   /* number of hard links */
    uid_t     st_uid;     /* user ID of owner */
    gid_t     st_gid;     /* group ID of owner */
    dev_t     st_rdev;    /* device ID (if special file) */
    off_t     st_size;    /* total size, in bytes */
    blksize_t st_blksize; /* blocksize for file system I/O */
    blkcnt_t  st_blocks;  /* number of 512B blocks allocated */
    time_t    st_atime;   /* time of last access */
    time_t    st_mtime;   /* time of last modification */
    time_t    st_ctime;   /* time of last status change */
&#125;;
</code></pre>
<p>è¿™é‡Œæ˜¯ <strong>st_blksize * st_blocks</strong>ï¼Œè¿”å› data æ–‡ä»¶å¤¹çš„å®é™…å¤§å°ï¼Œå•ä½æ˜¯ <strong>Bit</strong>ã€‚åœ¨ Native ä»£ç å®ç°ä¹Ÿç»å¸¸æ˜¯è¿™ä¸ªé€»è¾‘ã€‚æœ€åçœ‹ <strong>fileSize</strong> å‡½æ•°çš„å®ç°ï¼Œå®ƒå°†å¾ˆå¤§çš„æ¯”ç‰¹å€¼è½¬ä¸ºæ›´ä¸ºç›´è§‚å’Œåˆé€‚çš„ <strong>MB</strong> å’Œ <strong>GB</strong>ã€‚</p>
<pre><code class="language-Java">        private String fileSize(long j) &#123;
            Object[] objArr = &#123;new Long(j)&#125;;
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;6a69a740a4e2f5966b7d134666227a92&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
                return (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;6a69a740a4e2f5966b7d134666227a92&quot;);
            &#125;
            StringBuilder sb = new StringBuilder();
            String str = &quot;&quot;;
            if (j &gt;= 1024) &#123;
                str = &quot;KB&quot;;
                j /= 1024;
                if (j &gt;= 1024) &#123;
                    str = &quot;MB&quot;;
                    j /= 1024;
                    if (j &gt;= 1024) &#123;
                        str = &quot;GB&quot;;
                        j /= 1024;
                    &#125;
                &#125;
            &#125;
            sb.append(j);
            sb.append(str);
            return sb.toString();
        &#125;
</code></pre>
<p>è¿™é‡Œç›´æ¥é€šè¿‡ Frida Call è·å–è¿™ä¸ªå€¼ã€‚</p>
<pre><code class="language-js">function callSIUACollector() &#123;
  setTimeout(function () &#123;
    Java.perform(function () &#123;
      const ActivityThread = Java.use(&quot;android.app.ActivityThread&quot;);
      let context = ActivityThread.currentApplication().getApplicationContext();
      const ContextClass = Java.use(&quot;android.content.Context&quot;);
      const ctx = Java.cast(context, ContextClass);

      let SIUACollector = Java.use(
        &quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;
      );
      // ä¼ contextåˆ›å»ºå®ä¾‹
      let instance = SIUACollector.$new(ctx);

      let result = instance.getTotalInternalMemorySize();
      console.log(&quot;ret: &quot; + result);
    &#125;);
  &#125;, 3000);
&#125;
callSIUACollector();
</code></pre>
<p>æˆ‘çš„æµ‹è¯•æœºè·‘ä¸‹æ¥æ˜¯ 226GB</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getTotalInternalMemorySize()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;226GB&quot;);
&#125;
</code></pre>
<p>è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getTotalExternalMemorySize()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:222)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>é‚£ä¹ˆçœ‹çœ‹ <strong>getTotalExternalMemorySize</strong> å…·ä½“å®ç°</p>
<pre><code class="language-Java">
        private String getTotalExternalMemorySize() &#123;
            Object[] objArr = new Object[0];
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;522b1633753f28d5eb161a6c3ff3faa1&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
                return (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;522b1633753f28d5eb161a6c3ff3faa1&quot;);
            &#125;
            try &#123;
                if (!Environment.getExternalStorageState().equals(&quot;mounted&quot;)) &#123;
                    return &quot;&quot;;
                &#125;
                StatFs statFs = new StatFs(Environment.getExternalStorageDirectory().getPath());
                return fileSize(statFs.getBlockCount() * statFs.getBlockSize());
            &#125; catch (Exception e) &#123;
                c.a(e);
                MTGuardLog.error(e);
                return &quot;&quot;;
            &#125;
        &#125;
</code></pre>
<p>è¿™æ®µä»£ç å®ç°äº† <strong>è·å–å¤–éƒ¨å­˜å‚¨æ€»å®¹é‡</strong> çš„åŠŸèƒ½ï¼Œ<strong>Environment.getExternalStorageDirectory().getPath()</strong> è·å–å¤–éƒ¨å­˜å‚¨çš„è·¯å¾„ï¼ŒåŒæ ·çš„é‡‡å– Frida call ä¸€ä¸‹</p>
<pre><code class="language-js">function callSIUACollector() &#123;
  setTimeout(function () &#123;
    Java.perform(function () &#123;
      const ActivityThread = Java.use(&quot;android.app.ActivityThread&quot;);
      let context = ActivityThread.currentApplication().getApplicationContext();
      const ContextClass = Java.use(&quot;android.content.Context&quot;);
      const ctx = Java.cast(context, ContextClass);

      let SIUACollector = Java.use(
        &quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;
      );
      // ä¼ contextåˆ›å»ºå®ä¾‹
      let instance = SIUACollector.$new(ctx);

      let result = instance.getTotalExternalMemorySize();
      console.log(&quot;ret: &quot; + result);
    &#125;);
  &#125;, 3000);
&#125;
callSIUACollector();
</code></pre>
<p>ç»“æœå¦‚ä¸‹</p>
<pre><code class="language-shell">ret: 226GB
</code></pre>
<p>åŒæ ·æ˜¯ 226GB </p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getTotalExternalMemorySize()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;226GB&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">[!] check permission: android.permission.ACCESS_WIFI_STATE
[11:18:19 847]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x123, PC=unidbg@0xfffe02c4, LR=RX@0x1203d9a3[libmtguard.so]0x3d9a3, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isPermissionGranted(Ljava/lang/String;Landroid/content/Context;)Z
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:251)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callBooleanMethodA(DvmMethod.java:124)
</code></pre>
<p>è¿™æ˜¯åœ¨ç¡®è®¤æ˜¯å¦æœ‰è®¿é—® WiFi çŠ¶æ€çš„æƒé™ï¼Œç›´æ¥é€‰æ‹©è¿”å› Trueã€‚</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;isPermissionGranted(Ljava/lang/String;Landroid/content/Context;)Z&quot;:&#123;
    String permissionName = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;check permission:&quot;+permissionName);
    if(permissionName.equals(&quot;android.permission.READ_PHONE_STATE&quot;))&#123;
        return true;
    &#125;else if(permissionName.equals(&quot;android.permission.ACCESS_WIFI_STATE&quot;))&#123;
        return true;
    &#125;
    else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/text/TextUtils-&gt;isEmpty(Ljava/lang/CharSequence;)Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticBooleanMethodV(AbstractJni.java:191)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticBooleanMethodV(AbstractJni.java:186)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callStaticBooleanMethodV(DvmMethod.java:184)
</code></pre>
<p>è¿™æ˜¯ Android FrameWork ä¸­å¤„ç†å­—ç¬¦ä¸²çš„å·¥å…·ç±»ï¼Œè¿™ç§å·¥å…·å‡½æ•°å¾€å¾€ä¸ä¼šå¾ˆå¤æ‚ï¼Œåœ¨ <a target="_blank" rel="noopener" href="http://aospxref.com/android-9.0.0_r61/search?project=frameworks&full=&defs=&refs=&path=TextUtils.java&hist=&type=&xrd=&nn=1">AOSP</a> ä¸­æ‰¾ä¸€ä¸‹å®ƒçš„å®ç°ã€‚(ä½†æ˜¯ç›®å‰ Google å®˜æ–¹å¥½åƒå…³é—­äº†å®ƒçš„è®¿é—®)</p>
<p><img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/image-20250813112300853.png" alt="image-20250813112300853"></p>
<p>æ‰¾åˆ°å…·ä½“å®ç°</p>
<pre><code class="language-Java">public static boolean isEmpty(CharSequence str) &#123;
    return str == null || str.length() == 0;
&#125;
</code></pre>
<p>å¤å†™ä¸€ä¸‹</p>
<pre><code class="language-Java">@Override
public boolean callStaticBooleanMethodV(BaseVM vm, DvmClass dvmClass, String signature, VaList vaList) &#123;
    switch (signature)&#123;
        case &quot;android/text/TextUtils-&gt;isEmpty(Ljava/lang/CharSequence;)Z&quot;:&#123;
            String str = vaList.getObjectArg(0).getValue().toString();
            return str == null || str.length() == 0;
        &#125;
    &#125;
    return super.callStaticBooleanMethodV(vm, dvmClass, signature, vaList);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/telephony/TelephonyManager-&gt;getSimOperator()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:225)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>åˆæ˜¯ Android FrameWork é‡Œçš„å‡½æ•°ï¼ŒGoogle æ‰¾ç¯‡æ–‡ç« çœ‹ä¸‹ï¼Œæ¯”å¦‚<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/87602090">è¿™ç¯‡</a>ï¼Œå¾—çŸ¥è¿™æ˜¯åœ¨è·å–è¿è¡Œå•†ç›¸å…³çš„ä¿¡æ¯ã€‚</p>
<p>åŒæ ·å¯ä»¥é€šè¿‡ ADB è·å–å¾—åˆ°ç›¸å…³ä¿¡æ¯</p>
<pre><code class="language-shell">â””â”€Î” adb shell
ares:/ $ getprop | grep sim
[gsm.sim.num.simlock]: []
[gsm.sim.preiccid_0]: []
[gsm.sim.preiccid_1]: []
[gsm.sim.state]: [ABSENT,ABSENT]
[gsm.sim1.num.simlock]: []
[gsm.sim1.type]: []
[gsm.sim2.type]: []
[persist.log.tag.IsimFileHandler]: [I]
[persist.log.tag.IsimRecords]: [I]
[persist.log.tag.MtkCsimFH]: [I]
[persist.log.tag.MtkIsimFH]: [I]
[persist.log.tag.MtkUsimFH]: [I]
[persist.log.tag.VsimAdaptor]: [I]
[persist.radio.multisim.config]: [dsds]
[persist.vendor.radio.msimmode]: [dsds]
[persist.vendor.radio.sim.mode]: [3]
[persist.vendor.radio.simswitch]: [1]
[ril.csim.mlpl_mspl_ver0]: [,]
[ril.csim.mlpl_mspl_ver1]: [,]
[ro.mtk_perf_simple_start_win]: [1]
[ro.vendor.mtk_external_sim_only_slots]: [0]
[ro.vendor.mtk_external_sim_support]: [1]
[ro.vendor.mtk_sim_card_onoff]: [3]
[ro.vendor.radio.max.multisim]: [dsds]
[ro.vendor.sim_me_lock_mode]: [3]
[vendor.gsm.external.sim.connected]: [0]
[vendor.gsm.external.sim.timeout]: [13,13]
[vendor.gsm.modem.vsim.capability]: [2,2]
[vendor.gsm.sim.extended.format1]: [0]
[vendor.gsm.sim.extended.format2]: [0]
[vendor.gsm.sim.retry.pin1]: []
[vendor.gsm.sim.retry.pin1.2]: []
[vendor.gsm.sim.retry.pin2]: []
[vendor.gsm.sim.retry.pin2.2]: []
[vendor.gsm.sim.retry.puk1]: []
[vendor.gsm.sim.retry.puk1.2]: []
[vendor.gsm.sim.retry.puk2]: []
[vendor.gsm.sim.retry.puk2.2]: []
[vendor.gsm.sim.slot.lock.card.valid]: [2]
[vendor.gsm.sim.slot.lock.card.valid.2]: [2]
[vendor.gsm.sim.slot.lock.policy]: [3]
[vendor.gsm.sim.slot.lock.service.capability]: [4]
[vendor.gsm.sim.slot.lock.service.capability.2]: [4]
[vendor.gsm.sim.slot.lock.state]: [0]
[vendor.ril.sim.onoff.support]: [1]
[vendor.ril.sim.uicc.applications.enable.state]: [0]
[vendor.ril.sim.uicc.applications.enable.state.2]: [0]
[vendor.ril.simswitch.no_reset_support]: [1]
[vendor.ril.simswitch.tpluswsupport]: [1]
</code></pre>
<p>ä½†æ˜¯æˆ‘çš„æµ‹è¯•æœºä¸Šæ²¡æ’å¡ï¼Œä¹Ÿçœ‹ä¸å¤ªæ‡‚ï¼Œç›´æ¥è¯•ä¸€ä¸‹è¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œä¸è¡Œå†ä¼ªé€ ä¸€ä¸ªã€‚</p>
<p>è€Œå¦‚æœæµ‹è¯•æœºæ˜¯æœ‰å¡çš„è¯ï¼Œæ˜¯å¯ä»¥é‡‡é›†åˆ°å€¼çš„ï¼Œè¿”å›çš„å€¼æ˜¯ç”± MCC + MNC ç»„æˆã€‚</p>
<p><code>MCC</code>ç”±å›½é™…ç”µä¿¡è”ç›Ÿ ITU åœ¨å…¨ä¸–ç•ŒèŒƒå›´å†…ç»Ÿä¸€åˆ†é…å’Œç®¡ç†ï¼Œå”¯ä¸€è¯†åˆ«ç§»åŠ¨ç”¨æˆ·æ‰€å±çš„å›½å®¶ï¼Œå…±3ä½ï¼Œä¸­å›½ä¸º460ã€‚</p>
<p><code>MNC</code>ç”¨äºè¯†åˆ«ç§»åŠ¨ç”¨æˆ·æ‰€å½’å±çš„ç§»åŠ¨é€šä¿¡ç½‘ï¼Œ2~3ä½ã€‚ä¸­å›½ç§»åŠ¨ç³»ç»Ÿä½¿ç”¨ 00ã€02ã€04ã€07ï¼Œä¸­å›½è”é€šç³»ç»Ÿä½¿ç”¨ 01ã€06ã€09ï¼Œä¸­å›½ç”µä¿¡ä½¿ç”¨ 03ã€05ã€11ï¼Œä¸­å›½é“é€šç³»ç»Ÿä½¿ç”¨ 20 ã€‚</p>
<pre><code class="language-Java">case &quot;android/telephony/TelephonyManager-&gt;getSimOperator()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå‘ç°è¿˜çœŸè¿‡äº†ï¼Œç„¶åæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getAccessSubType()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:226)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
	at com.github.unidbg.linux.android.dvm.DalvikVM$33.handle(DalvikVM.java:578)
</code></pre>
<p>å» <strong>Jadx</strong> ä¸­çœ‹çœ‹ä¼ªä»£ç å®ç°</p>
<pre><code class="language-Java">
        @SuppressLint(&#123;&quot;MissingPermission&quot;&#125;)
        private String getAccessSubType() &#123;
            Object[] objArr = new Object[0];
            ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
            if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;4e473c1fae47c0bf65e6f819cd3eaf7c&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
                return (String) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;4e473c1fae47c0bf65e6f819cd3eaf7c&quot;);
            &#125;
            Context context = this.mContext;
            if (context == null) &#123;
                return StringUtil.NULL;
            &#125;
            if (!isPermissionGranted(&quot;android.permission.ACCESS_NETWORK_STATE&quot;, context)) &#123;
                return CommonConstant.Symbol.MINUS;
            &#125;
            ConnectivityManager connectivityManager = (ConnectivityManager) this.mContext.getApplicationContext().getSystemService(&quot;connectivity&quot;);
            NetworkInfo activeNetworkInfo = connectivityManager != null ? connectivityManager.getActiveNetworkInfo() : null;
            if (activeNetworkInfo == null) &#123;
                return StringUtil.NULL;
            &#125;
            if (activeNetworkInfo.getType() == 1) &#123;
                return &quot;wifi&quot;;
            &#125;
            if (activeNetworkInfo.getType() != 0) &#123;
                return &quot;&quot;;
            &#125;
            int subtype = activeNetworkInfo.getSubtype();
            return (subtype == 4 || subtype == 1 || subtype == 2) ? &quot;2G&quot; : (subtype == 3 || subtype == 8 || subtype == 6 || subtype == 5 || subtype == 12) ? &quot;3G&quot; : subtype == 13 ? &quot;4G&quot; : &quot;&quot;;
        &#125;
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯åœ¨è·å–ç½‘ç»œç±»å‹</p>
<pre><code class="language-Java">//æ£€æµ‹å½“å‰çš„ç½‘ç»œæ¨¡å¼ï¼Œå¯ä»¥æ˜¯ï¼šwifi/2G/3G/4G
case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getAccessSubType()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;wifi&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå¾—åˆ°ç»“æœ</p>
<pre><code class="language-shell">[*] getExternalEquipmentInfo:-|-|-|2400421080|226GB|226GB|AQmac|-|wifi|
</code></pre>
<h3 id="ä¸ƒã€getHWEquipmentInfo"><a href="#ä¸ƒã€getHWEquipmentInfo" class="headerlink" title="ä¸ƒã€getHWEquipmentInfo"></a>ä¸ƒã€getHWEquipmentInfo</h3><p>é¦–å…ˆå…ˆåˆå§‹åŒ–å‘èµ·è°ƒç”¨çœ‹çœ‹æŠ¥ä»€ä¹ˆé”™</p>
<pre><code class="language-Java">public String getHWEquipmentInfo()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getHWEquipmentInfo()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>æŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getCpuInfoType()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:140)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>å» <strong>Jadx</strong> ä¸­æŸ¥çœ‹å¯¹åº”æ–¹æ³•çš„ä¼ªä»£ç </p>
<pre><code class="language-Java">private String getCpuInfoType()&#123;
       Closeable uCloseable;
       Throwable throwable;
       String str1;
       int i = 0;
       Object[] objArray = new Object[i];
       ChangeQuickRedirect changeQuickR = NBridge$SIUACollector.changeQuickRedirect;
       if (PatchProxy.isSupport(objArray, this, changeQuickR, false, &quot;e8c17f92755628eaeec9e7e53ee668d7&quot;, 0x4000000000000000)) &#123;
          return PatchProxy.accessDispatch(objArray, this, changeQuickR, i, &quot;e8c17f92755628eaeec9e7e53ee668d7&quot;);
       &#125;
       String str = &quot;&quot;;
       int i1 = 0;
       try&#123;
          super(new InputStreamReader(new FileInputStream(&quot;/proc/cpuinfo&quot;)));
          try&#123;
             while ((str1 = this.readLine()) != null) &#123;
                if (str1.startsWith(&quot;Processor&quot;)) &#123;
                   str = &quot;arm&quot;;
                   break ;
                &#125;else if(str1.startsWith(&quot;model name&quot;))&#123;
                   str = &quot;x86&quot;;
                   break ;
                &#125;
             &#125;
             this.close();
          label_005e :
             this.safeClose(uCloseable);
             return str;
          &#125;catch(java.lang.Exception e1)&#123;
          &#125;
          c.a(throwable);
          MTGuardLog.error(throwable);
          goto label_005e ;
       &#125;catch(java.lang.Exception e2)&#123;
          uCloseable = i1;
          throwable = e2;
       &#125;
    &#125;
</code></pre>
<p>æ ¹æ®æ–¹æ³•åå’Œä»£ç é€»è¾‘å¯çŸ¥ï¼Œè¯¥æ–¹æ³•å°±æ˜¯è¯»å– <strong>&#x2F;proc&#x2F;cpuinfo</strong> æ–‡ä»¶ï¼Œæ ¹æ®å†…å®¹åˆ¤æ–­ CPU æ¶æ„ç±»å‹(arm&#x2F;x86)ï¼Œç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">// CPU æ¶æ„
case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getCpuInfoType()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;arm&quot;);
&#125;
</code></pre>
<p>è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/BufferedReader-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:93)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
	at com.github.unidbg.linux.android.dvm.DalvikVM$24.handle(DalvikVM.java:365)
</code></pre>
<p>å‰é¢ä¹Ÿé‡åˆ°è¿‡ä¸€ä¸ª <strong>allocObject</strong>ï¼Œä½ å¯èƒ½æƒ³å¦‚æ³•ç‚®åˆ¶</p>
<pre><code class="language-Java">case &quot;java/io/BufferedReader-&gt;allocObject&quot;:&#123;
    return ProxyDvmObject.createObject(vm, new BufferedReader());
&#125;
</code></pre>
<p>ä½†æœ€å¥½ä¸è¦è¿™ä¹ˆåšäº†ï¼Œè¿™æ˜¯æœ‰éšæ‚£çš„å¤„ç†æ–¹æ³•ã€‚BufferedReader æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œå®ƒæ‰€éœ€è¦çš„åˆå§‹åŒ–å‚æ•°åœ¨ <strong>allocObject</strong> é˜¶æ®µå¹¶æ²¡æœ‰å±•éœ²å‡ºæ¥ï¼Œåœ¨åç»­çœŸæ­£åˆå§‹åŒ–çš„æ—¶å€™æ‰æœ‰å€¼ã€‚</p>
<p>è¿™é‡Œç›´æ¥ç”¨ç©ºçš„ <strong>dvmObject</strong> å ä½ï¼Œè¿™é‡Œçš„ dvmClass ç­‰ä»·äº <strong>vm.resolveClass(â€œjava&#x2F;io&#x2F;BufferedReaderâ€)</strong>ã€‚</p>
<pre><code class="language-Java">    @Override
    public DvmObject&lt;?&gt; allocObject(BaseVM vm, DvmClass dvmClass, String signature) &#123;
        switch (signature) &#123;
            case &quot;java/lang/StringBuilder-&gt;allocObject&quot;: &#123;
                return ProxyDvmObject.createObject(vm, new StringBuilder());
            &#125;
            case &quot;java/io/BufferedReader-&gt;allocObject&quot;: &#123;
                return dvmClass.newObject(null);
            &#125;
        &#125;
        return super.allocObject(vm, dvmClass, signature);
    &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/InputStreamReader-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:96)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
</code></pre>
<p>æ˜¯ InputStreamReaderï¼ŒåŒæ ·å ä½å¤„ç†</p>
<pre><code class="language-Java">case &quot;java/io/InputStreamReader-&gt;allocObject&quot;:&#123;
    return dvmClass.newObject(signature);
&#125;
</code></pre>
<p>è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/FileInputStream-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:102)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
</code></pre>
<p>æ˜¯ <strong>FileInputStream</strong>ï¼ŒåŒç†</p>
<pre><code class="language-Java">case &quot;java/io/FileInputStream-&gt;allocObject&quot;:&#123;
    return dvmClass.newObject(signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/FileInputStream-&gt;&lt;init&gt;(Ljava/lang/String;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:115)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>ç»ˆäºåˆ°äº†è°ƒç”¨å…¶ <strong>init</strong> å‡½æ•°åšåˆå§‹åŒ–çš„é€»è¾‘ï¼Œå› ä¸º <strong>callVoid</strong> ç³»åˆ— API æ²¡æœ‰è¿”å›å€¼ï¼Œå®ƒçš„æ“ä½œåŸºäºåŸå…ˆçš„å ä½ <strong>dvmObject</strong>ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æ³•å¯¹å®ƒé‡æ–°å¤åˆ¶ï¼Œæ‰€ä»¥æˆ‘å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡å¤„ç†å®ƒä»¥åŠåé¢çš„é€»è¾‘ï¼Œåº”è¯¥è¯´æŒºéº»çƒ¦çš„ã€‚</p>
<pre><code class="language-Java">public class TEST4 extends AbstractJni implements IOResolver &#123;
    private final AndroidEmulator emulator;
    private final DvmObject&lt;?&gt; SIUACollector;
    private final VM vm;
    public FileInputStream fileInputStream;
</code></pre>
<p>ç„¶åè¡¥å…·ä½“é€»è¾‘</p>
<pre><code class="language-Java">case &quot;java/io/FileInputStream-&gt;&lt;init&gt;(Ljava/lang/String;)V&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;FileInputStream:&quot;+name);
    try &#123;
        fileInputStream = new FileInputStream(name);
    &#125; catch (FileNotFoundException e) &#123;
        e.printStackTrace();
    &#125;
    return;
&#125;
</code></pre>
<p>è¿è¡Œå‘ç°æœ‰é—®é¢˜</p>
<pre><code class="language-shell">FileInputStream: /proc/cpuinfo
JNIEnv-&gt;CallVoidMethodA(java.io.FileInputStream@2ddc8ecb, &lt;init&gt;(&quot;/proc/cpuinfo&quot;)) was called from RX@0x12030391[libmtguard.so]0x30391
JNIEnv-&gt;GetMethodID(java/io/InputStreamReader.&lt;init&gt;(Ljava/io/InputStream;)V) =&gt; 0x692aa2f2 was called from RX@0x12006369[libmtguard.so]0x6369
[14:33:20 104]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x13b, PC=unidbg@0xfffe0444, LR=RX@0x12029ed7[libmtguard.so]0x29ed7, syscall=null
java.lang.UnsupportedOperationException: java/io/InputStreamReader-&gt;&lt;init&gt;(Ljava/io/InputStream;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:128)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callVoidMethodA(DvmMethod.java:234)
	at com.github.unidbg.linux.android.dvm.DalvikVM$60.handle(DalvikVM.java:1076)
java.io.FileNotFoundException: \proc\cpuinfo (ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚)
	at java.base/java.io.FileInputStream.open0(Native Method)
	at java.base/java.io.FileInputStream.open(FileInputStream.java:219)
</code></pre>
<p>ç¨‹åºåœ¨è®¿é—® &#x2F;proc&#x2F;cpuinfo æ–‡ä»¶ï¼Œé¦–å…ˆå°† &#x2F;proc&#x2F;cpuinfo æ–‡ä»¶æ‹–åˆ°æœ¬åœ°</p>
<pre><code class="language-shell">â””â”€Î” adb pull /proc/cpuinfo xxx\unidbg\unidbg-android\src\test\java\com\test4
* daemon not running; starting now at tcp:5037
* daemon started successfully
/proc/cpuinfo: 1 file pulled, 0 skipped. 0.2 MB/s (1919 bytes in 0.011s)
</code></pre>
<p>ç„¶ååšè·¯å¾„é‡å®šä½</p>
<pre><code class="language-Java">case &quot;java/io/FileInputStream-&gt;&lt;init&gt;(Ljava/lang/String;)V&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    if(name.equals(&quot;/proc/cpuinfo&quot;))&#123;
        name = &quot;unidbg-android/src/test/java/com/test4/cpuinfo&quot;;
    &#125;
    System.out.println(&quot;FileInputStream:&quot;+name);
    try &#123;
        fileInputStream = new FileInputStream(name);
    &#125; catch (FileNotFoundException e) &#123;
        e.printStackTrace();
    &#125;
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/InputStreamReader-&gt;&lt;init&gt;(Ljava/io/InputStream;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:131)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callVoidMethodA(DvmMethod.java:234)
</code></pre>
<p>åŒç†å¤„ç†ä¸ºå…¨å±€å˜é‡</p>
<pre><code class="language-Java">public class TEST4 extends AbstractJni implements IOResolver &#123;
    private final AndroidEmulator emulator;
    private final DvmObject&lt;?&gt; SIUACollector;
    private final VM vm;
    public FileInputStream fileInputStream;
    public InputStreamReader inputStreamReader;
</code></pre>
<p>è¡¥æ–¹æ³•é€»è¾‘</p>
<pre><code class="language-Java">case &quot;java/io/InputStreamReader-&gt;&lt;init&gt;(Ljava/io/InputStream;)V&quot;:&#123;
    inputStreamReader = new InputStreamReader(fileInputStream);
    return;
&#125;
</code></pre>
<p>è¿™ä¸ª InputStream å‚æ•°å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„å…¨å±€å˜é‡ InputStreamï¼Œæ‰€ä»¥æ‹¿è¿‡æ¥ç”¨ã€‚</p>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/BufferedReader-&gt;&lt;init&gt;(Ljava/io/Reader;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:137)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>è¿™ä¸‰ä¸ªå…¶å®å°±æ˜¯ä¸€è¿å¥—çš„â€¦</p>
<pre><code class="language-Java">public class TEST4 extends AbstractJni implements IOResolver &#123;
    private final AndroidEmulator emulator;
    private final DvmObject&lt;?&gt; SIUACollector;
    private final VM vm;
    public FileInputStream fileInputStream;
    public InputStreamReader inputStreamReader;
    public BufferedReader bufferedReader;
</code></pre>
<p>å¤„ç†</p>
<pre><code class="language-Java">case &quot;java/io/BufferedReader-&gt;&lt;init&gt;(Ljava/io/Reader;)V&quot;:&#123;
    bufferedReader = new BufferedReader(inputStreamReader);
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/BufferedReader-&gt;readLine()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:180)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>ä¼¼ä¹å›å½’åˆ°äº†æˆ‘ä»¬æ›´ç†Ÿæ‚‰çš„é€»è¾‘é‡Œäº†</p>
<pre><code class="language-Java">case &quot;java/io/BufferedReader-&gt;readLine()Ljava/lang/String;&quot;:&#123;
    String oneline;
    try &#123;
        oneline = bufferedReader.readLine();
        if(oneline != null)&#123;
            return new StringObject(vm, oneline);
        &#125;else &#123;
            return null;
        &#125;
    &#125; catch (IOException e) &#123;
        e.printStackTrace();
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;compareToIgnoreCase(Ljava/lang/String;)I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:234)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
</code></pre>
<p>JDK æ–¹æ³•ï¼Œæ­£å¸¸è¡¥å³å¯</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;compareToIgnoreCase(Ljava/lang/String;)I&quot;:&#123;
    String str = vaList.getObjectArg(0).getValue().toString();
    return dvmObject.getValue().toString().compareToIgnoreCase(str);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;lastIndexOf(I)I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:238)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
</code></pre>
<p>ä¾æ—§æ˜¯ JDK æ–¹æ³•</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;lastIndexOf(I)I&quot;:&#123;
    return dvmObject.getValue().toString().lastIndexOf(vaList.getIntArg(0));
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œå’Œè¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;substring(I)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:194)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>è¡¥</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;substring(I)Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, dvmObject.getValue().toString().substring(vaList.getIntArg(0)));
&#125;
</code></pre>
<p>æŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/StringBuilder-&gt;append(I)Ljava/lang/StringBuilder;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:197)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">            case &quot;java/lang/StringBuilder-&gt;append(I)Ljava/lang/StringBuilder;&quot;: &#123;
                int value = vaList.getIntArg(0); // ç›´æ¥å– int
                ((StringBuilder) dvmObject.getValue()).append(value); // è‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²æ‹¼æ¥
                return dvmObject; // append è¿”å› this
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/BufferedReader-&gt;close()V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:139)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/io/BufferedReader-&gt;close()V&quot;:&#123;
    try &#123;
        bufferedReader.close();
    &#125; catch (IOException e) &#123;
        e.printStackTrace();
    &#125;
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/hardware/SensorManager-&gt;getDefaultSensor(I)Landroid/hardware/Sensor;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:229)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>ä¼ æ„Ÿå™¨ä¸€å‘æ˜¯æ”¶é›†ä¿¡æ¯çš„é‡ç‚¹ï¼Œå¤„ç†å®ƒéœ€è¦æ›´å¤šçš„è€å¿ƒã€‚</p>
<p>é¦–å…ˆæ˜¯è¿™ä¸ª API çš„åŸå‹</p>
<pre><code class="language-Java">Sensor getDefaultSensor(int type)
</code></pre>
<p>å®ƒä¼šä»ä¼ æ„Ÿå™¨æœåŠ¡è·å–æŒ‡å®šç±»å‹çš„ä¼ æ„Ÿå™¨ï¼Œæœ‰ç›¸å½“å¤šçš„ç±»å‹ï¼Œè¯¦è§ Android <a target="_blank" rel="noopener" href="http://aospxref.com/android-8.0.0_r36/xref/frameworks/base/core/java/android/hardware/Sensor.java">æºç </a>ã€‚</p>
<pre><code class="language-Java">public static final int TYPE_ACCELEROMETER = 1;
public static final int TYPE_ORIENTATION = 3;
public static final int TYPE_POSE_6DOF = 28;
public static final int TYPE_PRESSURE = 6;
public static final int TYPE_PROXIMITY = 8;
public static final int TYPE_RELATIVE_HUMIDITY = 12;
public static final int TYPE_ROTATION_VECTOR = 11;
public static final int TYPE_SIGNIFICANT_MOTION = 17;
public static final int TYPE_STATIONARY_DETECT = 29;
public static final int TYPE_STEP_COUNTER = 19;
public static final int TYPE_STEP_DETECTOR = 18;
public static final int TYPE_GRAVITY = 9;
</code></pre>
<p>æ‰“å°å‚æ•°ï¼Œçœ‹çœ‹æ ·æœ¬åœ¨è·å–å“ªç±»ä¼ æ„Ÿå™¨</p>
<pre><code class="language-Java">case &quot;android/hardware/SensorManager-&gt;getDefaultSensor(I)Landroid/hardware/Sensor;&quot;:&#123;
    int type = vaList.getIntArg(0);
    System.out.println(&quot;Sensor type:&quot;+type);
&#125;
</code></pre>
<p>è¿è¡Œ</p>
<pre><code class="language-Java">Sensor type:1
</code></pre>
<p>1 å¯¹åº”äºåŠ é€Ÿåº¦ä¼ æ„Ÿå™¨ï¼Œä¸‹é¢åšå¸¸è§„è¡¥ç¯å¢ƒï¼Œå°† type è®¾ä¸º DvmObject çš„å€¼ï¼Œå› ä¸ºæ‹…å¿ƒæ ·æœ¬ä¼šè·å–å¤šç§ä¼ æ„Ÿå™¨ï¼Œæ‰€ä»¥æå‰å¤„ç†ï¼Œä¾¿äºåŒºåˆ†ã€‚</p>
<pre><code class="language-Java">case &quot;android/hardware/SensorManager-&gt;getDefaultSensor(I)Landroid/hardware/Sensor;&quot;:&#123;
    int type = vaList.getIntArg(0);
    return vm.resolveClass(&quot;android/hardware/Sensor&quot;).newObject(type);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/hardware/Sensor-&gt;getName()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:234)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>è¿™é‡Œæ˜¯åœ¨è·å–ä¼ æ„Ÿå™¨çš„åå­—</p>
<p>è¯»è€…å¯ä»¥å†™ä¸€ä¸ª Android Java å±‚ demoï¼Œæ¥ç†è§£è¿™é‡Œçš„é€»è¾‘ï¼Œåœ¨ JNI ä¸­çœ‹èµ·æ¥æœ‰ç‚¹æ‡µï¼Œä½† Java å¤å†™å…¶å®ç›¸å½“ç®€å•</p>
<pre><code class="language-Java">SensorManager manager= (SensorManager)getSystemService(SENSOR_SERVICE);
Sensor accelSensor = manager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);
Log.e(&quot;lilac sensor Name&quot;,accelSensor.getName());
</code></pre>
<p>åœ¨æˆ‘çš„æµ‹è¯•æœºä¸Šè¿”å› ACCELEROMETER</p>
<p>æ”¶é›†ä¼ æ„Ÿå™¨çš„ä¿¡æ¯ï¼Œå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜»æ­¢ â€œæ”¹æœºâ€ ï¼Œå›½å†…ä¸»è¦å“ç‰Œã€ä¸»è¦å‹å· æ‰€å¯¹åº”çš„ä¼ æ„Ÿå™¨ä¿¡æ¯éƒ½å¯ä»¥æŸ¥åˆ°ï¼Œå¦‚æœä½ ä¿®æ”¹äº† Android è®¾å¤‡ä¿¡æ¯ï¼Œæ¯”å¦‚ä» pixel æ”¹æˆ çº¢ç±³ K40ï¼Œé‚£ä¹ˆå¯¹åº”çš„ï¼Œå„ç±»ä¼ æ„Ÿå™¨ä¿¡æ¯ä¹Ÿè¦æ”¹ã€‚å¦‚æœä¸åè°ƒåŒæ­¥åœ°æ”¹ï¼Œå°±ä¼šæœ‰ç ´ç»½ã€‚</p>
<p>ç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/hardware/Sensor-&gt;getName()Ljava/lang/String;&quot;:&#123;
    int type = (Integer) dvmObject.getValue();
    System.out.println(&quot;Sensor type: &quot; + type);
    if(type == 1)&#123;
        return new StringObject(vm, &quot;ACCELEROMETER&quot;);
    &#125;else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
</code></pre>
<p>è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/hardware/Sensor-&gt;getVendor()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:244)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>ä¼ æ„Ÿå™¨æœ‰ä¸€ç³»åˆ—å¯ä¾›è·å–çš„å±æ€§ã€‚</p>
<ul>
<li>getMaximumRange() æœ€å¤§å–å€¼èŒƒå›´</li>
<li>getName() è®¾å¤‡åç§°</li>
<li>getPower() åŠŸç‡</li>
<li>getResolution() ç²¾åº¦</li>
<li>getType() ä¼ æ„Ÿå™¨ç±»å‹</li>
<li>getVentor() è®¾å¤‡ä¾›åº”å•†</li>
<li>getVersions() è®¾å¤‡ç‰ˆæœ¬å·</li>
</ul>
<p>è¿™é‡Œæ˜¯åœ¨è·å–è®¾å¤‡ä¾›åº”å•†ä¿¡æ¯ï¼Œåœ¨ Android demo ä¸­å¦‚æ³•ç‚®åˆ¶</p>
<pre><code class="language-Java">SensorManager manager= (SensorManager)getSystemService(SENSOR_SERVICE);
Sensor accelSensor = manager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER);
Log.e(&quot;lilac sensor Name&quot;,accelSensor.getName());
Log.e(&quot;lilac sensor Vendor&quot;,accelSensor.getVendor());
</code></pre>
<p>è¿è¡Œdemoï¼Œçœ‹ä¸‹æ—¥å¿—å°±çŸ¥é“äº†<br>æˆ‘çš„æµ‹è¯•æœºè¿”å›çš„æ˜¯ï¼Œ<strong>lsm6dsoe_acc</strong>ï¼Œæ˜¯ STMicroelectronics (ST) ç”Ÿäº§çš„ MEMS ä¼ æ„Ÿå™¨ã€‚ç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/hardware/Sensor-&gt;getVendor()Ljava/lang/String;&quot;:&#123;
    int type = (int) dvmObject.getValue();
    System.out.println(&quot;Sensor getVendor:&quot; + type);
    if(type == 1)&#123;
        return new StringObject(vm, &quot;lsm6dsoe_acc&quot;);
    &#125;else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">[!] Sensor type(getName): 9
[15:14:41 209]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x1202ad4f[libmtguard.so]0x2ad4f, syscall=null
java.lang.UnsupportedOperationException: android/hardware/Sensor-&gt;getName()Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:240)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåˆè·å¾—äº†å¦ä¸€ç§ä¼ æ„Ÿå™¨ï¼Œ9 æ˜¯ TYPE_GRAVITY å³é‡åŠ›ä¼ æ„Ÿå™¨ã€‚å°† Android demo ç¨åŠ ä¿®æ”¹</p>
<pre><code class="language-Java">SensorManager manager= (SensorManager)getSystemService(SENSOR_SERVICE);
Sensor accelSensor = manager.getDefaultSensor(Sensor.TYPE_GRAVITY);
Log.e(&quot;lilac sensor Name&quot;,accelSensor.getName());
Log.e(&quot;lilac sensor Vendor&quot;,accelSensor.getVendor());
</code></pre>
<p>ä¼ æ„Ÿå™¨åä¸º GRAVITYï¼Œvendor æ˜¯ MTKï¼Œç»§ç»­å®Œå–„è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/hardware/Sensor-&gt;getName()Ljava/lang/String;&quot;:&#123;
    int type = (int) dvmObject.getValue();
    System.out.println(&quot;Sensor getName:&quot;+type);
    if(type == 1)&#123;
        return new StringObject(vm, &quot;ACCELEROMETER&quot;);
    &#125;else if(type == 9)&#123;
        return new StringObject(vm, &quot;GRAVITY&quot;);
    &#125;
    else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
case &quot;android/hardware/Sensor-&gt;getVendor()Ljava/lang/String;&quot;:&#123;
    int type = (int) dvmObject.getValue();
    System.out.println(&quot;Sensor getVendor:&quot;+type);
    if(type == 1)&#123;
        return new StringObject(vm, &quot;lsm6dsoe_acc&quot;);
    &#125;else if(type == 9)&#123;
        return new StringObject(vm, &quot;MTK&quot;);
    &#125;
    else &#123;
        throw new UnsupportedOperationException(signature);
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;safeClose(Ljava/io/Closeable;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:147)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callVoidMethodA(DvmMethod.java:234)
</code></pre>
<p>åœ¨ Jadx ä¸­æŸ¥çœ‹å¯¹åº”çš„åç¼–è¯‘ä»£ç </p>
<pre><code class="language-Java">private void safeClose(Closeable closeable) &#123;
    Object[] objArr = &#123;closeable&#125;;
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;148f9159176b748328c0fe05c9308265&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;148f9159176b748328c0fe05c9308265&quot;);
    &#125; else &#123;
        MTGUtils.safeClose(closeable);
    &#125;
&#125;
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯å¤„ç†å®Œä¹‹åçš„èµ„æºå…³é—­æ“ä½œï¼Œç®€å•å¤„ç†å³å¯</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;safeClose(Ljava/io/Closeable;)V&quot;:&#123;
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå‘ç°å·²ç»è·‘å®Œäº†</p>
<pre><code class="language-shell">[*] getHWEquipmentInfo:-|MT6893Z/CZA|8|ACCELEROMETER|lsm6dsoe_acc|GYROSCOPE|MTK|
</code></pre>
<h3 id="å…«ã€getHWProperty"><a href="#å…«ã€getHWProperty" class="headerlink" title="å…«ã€getHWProperty"></a>å…«ã€getHWProperty</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">public String getHWProperty()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getHWProperty()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>æ–°ä¸€è½®çš„è¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;BOARD:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>å¯¹äº Build ä¸‹çš„æ•°æ®ï¼ŒåŒæ ·å¯ä»¥å†™ demo çœ‹ï¼Œè¿™ä¸ªåŠæ³•çµæ´»å¥½ç”¨ï¼Œæˆ–è€…ä½¿ç”¨ ADB ä¹Ÿè¡Œã€‚è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨ adb æŒ‡ä»¤äº†</p>
<pre><code class="language-shell">â””â”€Î” adb shell
ares:/ $ getprop | grep board
[ro.board.first_api_level]: [30]
[ro.board.platform]: [mt6893]
[ro.miui.has_security_keyboard]: [1]
[ro.product.board]: [ares]
[sys.haptic.intensityforkeyboard]: [true]
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">@Override
public DvmObject&lt;?&gt; getStaticObjectField(BaseVM vm, DvmClass dvmClass, String signature) &#123;
    switch (signature)&#123;
        case &quot;android/os/Build-&gt;BOARD:Ljava/lang/String;&quot;:&#123;
            return new StringObject(vm, &quot;mt6893&quot;);
        &#125;
    &#125;
    return super.getStaticObjectField(vm, dvmClass, signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;MANUFACTURER:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:366)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>åŒç†</p>
<pre><code class="language-shell">ares:/ $ getprop | grep manufacturer
[ro.product.bootimage.manufacturer]: [xiaomi]
[ro.product.manufacturer]: [Xiaomi]
[ro.product.odm.manufacturer]: [Xiaomi]
[ro.product.product.manufacturer]: [Xiaomi]
[ro.product.system.manufacturer]: [xiaomi]
[ro.product.system_ext.manufacturer]: [xiaomi]
[ro.product.vendor.manufacturer]: [Xiaomi]
[ro.product.vendor_dlkm.manufacturer]: [xiaomi]
[ro.soc.manufacturer]: [Mediatek]
</code></pre>
<p>ç»“æœæ˜¯ Xiaomiï¼Œè¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;MANUFACTURER:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;Xiaomi&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;BRAND:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:369)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>brand è‚¯å®šæ˜¯çº¢ç±³ï¼Œä¸è¿‡è¿˜æ˜¯è¿è¡Œä¸€ä¸‹çœ‹çœ‹</p>
<pre><code class="language-shell">ares:/ $ getprop | grep brand
[ro.product.bootimage.brand]: [redmi]
[ro.product.brand]: [Redmi]
[ro.product.odm.brand]: [Redmi]
[ro.product.product.brand]: [Redmi]
[ro.product.system.brand]: [redmi]
[ro.product.system_ext.brand]: [redmi]
[ro.product.vendor.brand]: [Redmi]
[ro.product.vendor_dlkm.brand]: [redmi]
</code></pre>
<p>ç»“æœæ˜¯ Redmi</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;BRAND:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;Redmi&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œæ¥ç€æ˜¯ MODEL</p>
<pre><code class="language-Java">java.lang.UnsupportedOperationException: android/os/Build-&gt;MODEL:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:372)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
</code></pre>
<p>åŒç†</p>
<pre><code class="language-shell">ares:/ $ getprop | grep model
[ro.product.bootimage.model]: [ares]
[ro.product.model]: [M2012K10C]
[ro.product.odm.model]: [M2012K10C]
[ro.product.product.model]: [M2012K10C]
[ro.product.system.model]: [missi]
[ro.product.system_ext.model]: [missi]
[ro.product.vendor.model]: [M2012K10C]
[ro.product.vendor_dlkm.model]: [ares]
[ro.soc.model]: [MT6893]
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;MODEL:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;M2012K10C&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:269)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>getSysProp æ˜¯ä¸€ä¸ªç”¨äºè·å–ç³»ç»Ÿå±æ€§çš„å·¥å…·å‡½æ•°ï¼Œåç¼–è¯‘ä»£ç å¦‚ä¸‹ã€‚</p>
<pre><code class="language-Java">public static String getSysProp(String str) &#123;
    Object[] objArr = &#123;str&#125;;
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;31aaabc5cd1287cb6e2e62ee32d788e0&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;31aaabc5cd1287cb6e2e62ee32d788e0&quot;);
    &#125;
    if (TextUtils.isEmpty(str)) &#123;
        return &quot;&quot;;
    &#125;
    try &#123;
        Class&lt;?&gt; cls = Class.forName(&quot;android.os.SystemProperties&quot;);
        return (String) cls.getDeclaredMethod(&quot;get&quot;, String.class).invoke(cls, str);
    &#125; catch (Throwable th) &#123;
        c.a(th);
        MTGuardLog.error(th);
        return &quot;&quot;;
    &#125;
&#125;
</code></pre>
<p>æµ…æµ…æ‰“å°ä¸€ä¸‹å‚æ•°</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;getSysProp:&quot;+name);
&#125;
</code></pre>
<p>è¿è¡Œä»£ç </p>
<pre><code class="language-shell">[!] getSysProp: ro.product.cpu.abi
[15:54:43 498]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x1200d2a7[libmtguard.so]0xd2a7, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:273)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
	at com.github.unidbg.linux.android.dvm.DalvikVM$33.handle(DalvikVM.java:578)
</code></pre>
<p>æ—¢ç„¶æ˜¯å±æ€§ä¿¡æ¯ï¼Œç”¨ adb è·å–å¾ˆæ–¹ä¾¿ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯</p>
<pre><code class="language-shell">ares:/ $ getprop | grep ro.product.cpu.abi
[ro.product.cpu.abi]: [arm64-v8a]
[ro.product.cpu.abilist]: [arm64-v8a,armeabi-v7a,armeabi]
[ro.product.cpu.abilist32]: [armeabi-v7a,armeabi]
[ro.product.cpu.abilist64]: [arm64-v8a]
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;getSysProp:&quot;+name);
    if(name.equals(&quot;ro.product.cpu.abi&quot;))&#123;
        return new StringObject(vm, &quot;arm64-v8a&quot;);
    &#125;
    throw new UnsupportedOperationException(signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">[!] getSysProp: ro.product.cpu.abi2
[15:58:21 719]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x12018613[libmtguard.so]0x18613, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:274)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>æˆ‘çš„æµ‹è¯•æœºå°±ä¸€ä¸ªåˆ†åŒºï¼Œæ‰€ä»¥ç”¨ adb æŒ‡ä»¤æŸ¥ä¸åˆ°ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²å°±å¥½</p>
<pre><code class="language-Java">else if(name.equals(&quot;ro.product.cpu.abi2&quot;)) &#123;
    return new StringObject(vm, &quot;&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;PRODUCT:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:386)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
</code></pre>
<p>æ¥è¿ç€çš„æ˜¯ PRODUCTã€HARDWAREã€DEVICEï¼Œä¾æ¬¡è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;PRODUCT:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;missi&quot;);
&#125;
case &quot;android/os/Build-&gt;HARDWARE:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;mt6893&quot;);
&#125;
case &quot;android/os/Build-&gt;DEVICE:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;ares&quot;);
&#125;
</code></pre>
<p>ç©¿æ’</p>
<pre><code class="language-shell">[!] getSysProp: ro.build.product
[16:04:14 251]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x1201831f[libmtguard.so]0x1831f, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:277)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>æ˜¾ç„¶åˆæ˜¯æ‰€è°“çš„å¤šé‡æ ¡éªŒï¼Œå¤šä¸ª API è·å–ç›¸åŒä¿¡æ¯</p>
<p>ç„¶ååˆæ˜¯ HOST å’Œ ID</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;HOST:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;c4-xm-ota-bd093.bj&quot;);
&#125;
case &quot;android/os/Build-&gt;ID:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;SP1A.210812.016&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build$VERSION-&gt;RELEASE:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:405)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>åœ¨ adb ä¸­æ‰¾åˆ°</p>
<pre><code class="language-shell">[ro.build.version.release]: [12]
</code></pre>
<p>ç„¶åè¡¥ç¯å¢ƒï¼Œç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/Integer-&gt;toString(I)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:504)
	at com.test4.TEST4.callStaticObjectMethodV(TEST4.java:327)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callStaticObjectMethodV(AbstractJni.java:438)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/Integer-&gt;toString(I)Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, Integer.toString(vaList.getIntArg(0)));
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/Context-&gt;getResources()Landroid/content/res/Resources;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:284)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>Resources å³èµ„æºï¼Œçœ‹æ¥æ˜¯æ–°çš„é€»è¾‘ã€‚</p>
<pre><code class="language-Java">case &quot;android/content/Context-&gt;getResources()Landroid/content/res/Resources;&quot;:&#123;
    return vm.resolveClass(&quot;android/content/res/Resources&quot;).newObject(null);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå‘ç°åŸæ¥æ˜¯æƒ³è·å–é…ç½®ä¿¡æ¯</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/res/Resources-&gt;getConfiguration()Landroid/content/res/Configuration;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:286)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/content/res/Resources-&gt;getConfiguration()Landroid/content/res/Configuration;&quot;:&#123;
    return vm.resolveClass(&quot;android/content/res/Configuration&quot;).newObject(null);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/res/Configuration-&gt;locale:Ljava/util/Locale;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:171)
	at com.test4.TEST4.getObjectField(TEST4.java:299)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:141)
</code></pre>
<p>å…·ä½“è€Œè¨€ï¼Œæ˜¯è·å–åŒºåŸŸä¿¡æ¯ï¼Œlocaleåœ¨ JDK é‡Œä¹Ÿæœ‰ï¼Œæ‰€ä»¥æ”¹ç”¨ createObjectã€‚</p>
<pre><code class="language-Java">case &quot;android/content/res/Configuration-&gt;locale:Ljava/util/Locale;&quot;:&#123;
    return ProxyDvmObject.createObject(vm, Locale.getDefault());
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;TAGS:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:421)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>ADB grep ä¸€ä¸‹ï¼Œro.build.tags çš„å€¼æ˜¯ release-keysã€‚</p>
<pre><code class="language-shell">ares:/ $ getprop | grep tags
[debug.atrace.tags.enableflags]: [0]
[ro.bootimage.build.tags]: [release-keys]
[ro.build.tags]: [release-keys]
[ro.product.build.tags]: [release-keys]
[ro.system.build.tags]: [release-keys]
[ro.system_ext.build.tags]: [release-keys]
[ro.vendor.build.tags]: [release-keys]
[ro.vendor_dlkm.build.tags]: [release-keys]
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;TAGS:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;release-keys&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build-&gt;FINGERPRINT:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:424)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
</code></pre>
<p>æ¥ä¸‹æ¥æ˜¯ FINGERPRINTã€TYPEã€‚</p>
<pre><code class="language-Java">case &quot;android/os/Build-&gt;FINGERPRINT:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;redmi/missi/missi:12/SP1A.210812.016/V13.0.8.0.SKJCNXM:user/release-keys&quot;);
&#125;
case &quot;android/os/Build-&gt;TYPE:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;user&quot;);
&#125;
</code></pre>
<p>è¿è¡Œï¼Œåˆæ˜¯ getSysProp</p>
<pre><code class="language-shell">[!] getSysProp: ro.build.description
[16:53:59 982]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x1200ca17[libmtguard.so]0xca17, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:282)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>adb è·å–ä¸€ä¸‹ä¿¡æ¯ï¼Œç„¶åè¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">ares:/ $ getprop | grep ro.build.description
[ro.build.description]: [missi-user 12 SP1A.210812.016 V13.0.8.0.SKJCNXM release-keys]
</code></pre>
<p>ç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">else if(name.equals(&quot;ro.build.description&quot;))&#123;
    return new StringObject(vm, &quot;missi-user 12 SP1A.210812.016 V13.0.8.0.SKJCNXM release-keys&quot;);
&#125;
</code></pre>
<p>è¿è¡Œï¼Œè¿˜æ˜¯ getSysProp è°ƒç”¨ï¼Œå‚æ•°æ˜¯ ro.secure</p>
<pre><code class="language-Java">else if(name.equals(&quot;ro.secure&quot;))&#123;
    return new StringObject(vm, &quot;1&quot;);
&#125;
</code></pre>
<p>ç»§ç»­ï¼Œæ¥ç€æ˜¯ ro.debuggable</p>
<pre><code class="language-Java">if(name.equals(&quot;ro.debuggable&quot;))&#123;
    return new StringObject(vm, &quot;0&quot;);
&#125;
</code></pre>
<p>è¿è¡Œä»£ç ï¼Œå¾—å‡ºç»“æœã€‚</p>
<pre><code class="language-shell">[*] getHWProperty: mt6893|Xiaomi|Redmi|M2012K10C|arm64-v8a|-|missi|mt6893|ares|missi|c4-xm-ota-bd093.bj|SP1A.210812.016|12|35|zh|CN|release-keys|redmi/missi/missi:12/SP1A.210812.016/V13.0.8.0.SKJCNXM:user/release-keys|user|missi-user 12 SP1A.210812.016 V13.0.8.0.SKJCNXM release-keys|1|0|
</code></pre>
<h3 id="ä¹ã€getHWStatus"><a href="#ä¹ã€getHWStatus" class="headerlink" title="ä¹ã€getHWStatus"></a>ä¹ã€getHWStatus</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">public String getHWStatus()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getHWStatus()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>å¼€å§‹è¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">[!] getSysProp: persist.sys.usb.config
[17:04:12 708]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x12023a11[libmtguard.so]0x23a11, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:297)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
	at com.github.unidbg.linux.android.dvm.DalvikVM$33.handle(DalvikVM.java:578)
</code></pre>
<p>è¿™æ˜¯åœ¨è·å–è®¾å¤‡æ˜¯å¦è¿æ¥äº† ADBï¼Œå› æ­¤è¿”å›ç©ºå­—ç¬¦ä¸²ä¸ºå¥½ï¼Œæ¥è¿ä¸‰ä¸ªéƒ½æ˜¯ç±»ä¼¼çš„å±æ€§ã€‚</p>
<pre><code class="language-Java">if(name.equals(&quot;persist.sys.usb.config&quot;))&#123;
    return new StringObject(vm, &quot;&quot;);
&#125;
if(name.equals(&quot;sys.usb.config&quot;))&#123;
    return new StringObject(vm, &quot;&quot;);
&#125;
if(name.equals(&quot;sys.usb.state&quot;))&#123;
    return new StringObject(vm, &quot;&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/content/pm/PackageManager-&gt;hasSystemFeature(Ljava/lang/String;)Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:351)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callBooleanMethodA(DvmMethod.java:124)
	at com.github.unidbg.linux.android.dvm.DalvikVM$36.handle(DalvikVM.java:655)
</code></pre>
<p>æŸ¥è¯¢å¯çŸ¥ï¼Œ<strong>hasSystemFeature</strong> ç”¨äºç¡®è®¤è®¾å¤‡æ˜¯å¦æœ‰ç‰¹å®šçš„åŠŸèƒ½æ¨¡å—ï¼Œæ‰“å°å‚æ•°çœ‹çœ‹</p>
<pre><code class="language-Java">case &quot;android/content/pm/PackageManager-&gt;hasSystemFeature(Ljava/lang/String;)Z&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;check hasSystemFeature:&quot;+name);
&#125;
</code></pre>
<p>å‘ç°æ˜¯æ£€æµ‹æ˜¯å¦å­˜åœ¨åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨</p>
<pre><code class="language-shell">check hasSystemFeature:android.hardware.sensor.accelerometer
</code></pre>
<p>è¿”å› Trueï¼Œç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;boolean2Integer(Z)I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:400)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callIntMethodA(DvmMethod.java:134)
</code></pre>
<p><strong>jadx</strong> æŸ¥çœ‹å¯¹åº”ä¼ªä»£ç </p>
<pre><code class="language-Java">private int boolean2Integer(boolean z) &#123;
         return z ? 1 : 0;
&#125;
</code></pre>
<p>å¾ˆç®€å•ï¼Œç›´æ¥è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;boolean2Integer(Z)I&quot;: &#123;
                return vaList.getIntArg(0);
            &#125;
</code></pre>
<p>ç„¶åè¿è¡Œï¼Œå‘ç°åˆæ£€æµ‹äº†ä¸å°‘ä¼ æ„Ÿå™¨å’Œç¡¬ä»¶æ”¯æŒï¼Œå‚è€ƒæ–‡ç« ä¸­è¡¥äº†ä¸‹é¢è¿™ä¹ˆå¤šï¼Œä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰è¡¥è¿™ä¹ˆå¤š</p>
<pre><code class="language-Java">case &quot;android/content/pm/PackageManager-&gt;hasSystemFeature(Ljava/lang/String;)Z&quot;:&#123;
    String name = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;check hasSystemFeature:&quot;+name);
    switch (name)&#123;
            // æ£€æµ‹åŠ é€Ÿä¼ æ„Ÿå™¨
        case &quot;android.hardware.sensor.accelerometer&quot;:&#123;
            return true;
        &#125;
            // æ£€æµ‹é™€èºä»ªä¼ æ„Ÿå™¨
        case &quot;android.hardware.sensor.gyroscope&quot;:&#123;
            return true;
        &#125;
            // wifi
        case &quot;android.hardware.wifi&quot;:&#123;
            return true;
        &#125;
            // è“ç‰™
        case &quot;android.hardware.bluetooth&quot;:&#123;
            return true;
        &#125;
            // è“ç‰™ä½åŠŸè€—
        case &quot;android.hardware.bluetooth_le&quot;:&#123;
            return true;
        &#125;
            // ç”µè¯
        case &quot;android.hardware.telephony&quot;:&#123;
            return true;
        &#125;
            // USB é…ä»¶API
        case &quot;android.hardware.usb.accessory&quot;:&#123;
            return true;
        &#125;
            // gps
        case &quot;android.hardware.location.gps&quot;:&#123;
            return true;
        &#125;
            // nfc
        case &quot;android.hardware.nfc&quot;:&#123;
            return true;
        &#125;
    &#125;
&#125;
</code></pre>
<pre><code class="language-Java">case &quot;android/content/pm/PackageManager-&gt;hasSystemFeature(Ljava/lang/String;)Z&quot;: &#123;
                String name = vaList.getObjectArg(0).getValue().toString();
                System.out.println(&quot;[!] Check hasSystemFeature: &quot; + name);
                switch (name) &#123;
                    // æ£€æµ‹åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨
                    case &quot;android.hardware.sensor.accelerometer&quot;: &#123;
                        return true;
                    &#125;
                    // æ£€æµ‹é™€èºä»ªä¼ æ„Ÿå™¨
                    case &quot;android.hardware.sensor.gyroscope&quot;: &#123;
                        return true;
                    &#125;
                &#125;
            &#125;
</code></pre>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¹Ÿè¿˜æ¶‰åŠåˆ°å…¶ä»–çš„å‡ ä¸ªè¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">[!] getSysProp: gsm.version.baseband
[17:27:30 570]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x120, PC=unidbg@0xfffe0294, LR=RX@0x12024d7f[libmtguard.so]0x24d7f, syscall=null
java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getSysProp(Ljava/lang/String;)Ljava/lang/String;
	at com.test4.TEST4.callObjectMethodV(TEST4.java:306)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
	at com.github.unidbg.linux.android.dvm.DalvikVM$33.handle(DalvikVM.java:578)
</code></pre>
<p>ä¹Ÿè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·è¡¥ä¸€ä¸‹</p>
<pre><code class="language-Java">else if (name.equals(&quot;gsm.version.baseband&quot;)) &#123;
                    return new StringObject(vm, &quot;MOLY.NR15.R3.TC8.PR2.SP.V2.1.P23,MOLY.NR15.R3.TC8.PR2.SP.V2.1.P23&quot;);
                &#125;
                else if (name.equals(&quot;gsm.version.ril-impl&quot;)) &#123;
                    return new StringObject(vm, &quot;android reference-ril 1.0&quot;);
                &#125;
                else if (name.equals(&quot;gsm.sim.state&quot;)) &#123;
                    return new StringObject(vm, &quot;ABSENT,ABSENT&quot;);
                &#125;
                else if (name.equals(&quot;gsm.sim.state.2&quot;)) &#123;
                    return new StringObject(vm, &quot;&quot;);
                &#125;
                else if (name.equals(&quot;wifi.interface&quot;)) &#123;
                    return new StringObject(vm, &quot;&quot;);
                &#125;
</code></pre>
<p>è¿˜æœ‰ä¸€äº›å…¶ä»–ç±»å‹çš„é”™è¯¯</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/File-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:122)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
	at com.github.unidbg.linux.android.dvm.DalvikVM$24.handle(DalvikVM.java:365)
</code></pre>
<p>å’Œä¹‹å‰ä¸€æ ·å¤„ç†</p>
<pre><code class="language-Java">case &quot;java/io/File-&gt;allocObject&quot;: &#123;
                return dvmClass.newObject(signature);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/File-&gt;&lt;init&gt;(Ljava/lang/String;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:167)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>å’Œå…ˆå‰ä¸€æ ·ï¼Œç”¨å…¨å±€å˜é‡å¤„ç†ï¼Œå› ä¸ºæ‹…å¿ƒä¼šåˆå§‹åŒ–å¤šä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å‘½åä¸º file1</p>
<pre><code class="language-Java">public class TEST4 extends AbstractJni implements IOResolver &#123;
    private final AndroidEmulator emulator;
    private final DvmObject&lt;?&gt; SIUACollector;
    private final VM vm;
    public FileInputStream fileInputStream;
    public InputStreamReader inputStreamReader;
    public BufferedReader bufferedReader;
    public File file1;
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/io/File-&gt;&lt;init&gt;(Ljava/lang/String;)V&quot;:&#123;
    String path = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;filePath:&quot;+path);
&#125;
</code></pre>
<p>è¿è¡Œ</p>
<pre><code class="language-shell">filePath:/sys/class/power_supply/battery/voltage_now
</code></pre>
<p>è¿™æ˜¯ç”µæ± ä¿¡æ¯æœ‰å…³çš„æ–‡ä»¶</p>
<pre><code class="language-shell">1|ares:/ $ su
ares:/ # cat /sys/class/power_supply/battery/voltage_now
4227000
</code></pre>
<p>åœ¨ Unidbg ä¸­å»ºç«‹å¯¹åº”çš„æ–‡ä»¶ï¼Œè¡¥ç¯å¢ƒï¼Œé‡å®šå‘</p>
<pre><code class="language-Java">case &quot;java/io/File-&gt;&lt;init&gt;(Ljava/lang/String;)V&quot;:&#123;
    String path = vaList.getObjectArg(0).getValue().toString();
    System.out.println(&quot;filePath:&quot;+path);
    if(path.equals(&quot;/sys/class/power_supply/battery/voltage_now&quot;))&#123;
        file1 = new File(&quot;unidbg-android/src/test/resources/dianping/files/voltage_now&quot;);
        return;
    &#125;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/io/File-&gt;exists()Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:391)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
</code></pre>
<p>ç»§ç»­è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/io/File-&gt;exists()Z&quot;:&#123;
    return file1.exists();
&#125;
</code></pre>
<p>ç›´æ¥è¿”å› true ä¹Ÿè¡Œï¼Œå› ä¸ºè¿™é‡Œåˆ¤æ–­çš„å°±æ˜¯æˆ‘ä»¬åˆšå¤„ç†çš„ file1 æ˜¯å¦å­˜åœ¨ã€‚<br>è¿è¡Œï¼Œç„¶åæ ·æœ¬åˆå¼€å§‹å¤„ç†å¦ä¸€ä¸ªæ–‡ä»¶</p>
<pre><code class="language-shell">Filepath: /sys/class/power_supply/battery/temp
[17:52:27 885]  WARN [com.github.unidbg.linux.ARM32SyscallHandler] (ARM32SyscallHandler:538) - handleInterrupt intno=2, NR=-452987096, svcNumber=0x13b, PC=unidbg@0xfffe0444, LR=RX@0x12026601[libmtguard.so]0x26601, syscall=null
java.lang.UnsupportedOperationException: java/io/File-&gt;&lt;init&gt;(Ljava/lang/String;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:176)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/io/File-&gt;&lt;init&gt;(Ljava/lang/String;)V&quot;: &#123;
                String path = vaList.getObjectArg(0).getValue().toString();
                System.out.println(&quot;Filepath: &quot; + path);
                if (path.equals(&quot;/sys/class/power_supply/battery/voltage_now&quot;)) &#123;
                    file1 = new File(&quot;unidbg-android/src/test/java/com/test4/voltage_now&quot;);
                    return;
                &#125;
                else if (path.equals(&quot;/sys/class/power_supply/battery/temp&quot;)) &#123;
                    file2 = new File(&quot;unidbg-android/src/test/java/com/test4/temp&quot;);
                    return;
                &#125;
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå¾—åˆ°ç»“æœ</p>
<pre><code class="language-shell">[*] getHWStatus: -|-|-|1|1|MOLY.NR15.R3.TC8.PR2.SP.V2.1.P23,MOLY.NR15.R3.TC8.PR2.SP.V2.1.P23|android reference-ril 1.0|ABSENT,ABSENT|-|1|1|1|-|1|1|1|1|1|1|1|
</code></pre>
<h3 id="åã€getLocationInfo"><a href="#åã€getLocationInfo" class="headerlink" title="åã€getLocationInfo"></a>åã€getLocationInfo</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">public String getLocationInfo()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getLocationInfo()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/net/wifi/WifiManager-&gt;getConnectionInfo()Landroid/net/wifi/WifiInfo;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:353)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;android/net/wifi/WifiManager-&gt;getConnectionInfo()Landroid/net/wifi/WifiInfo;&quot;:&#123;
    return vm.resolveClass(&quot;android/net/wifi/WifiInfo&quot;).newObject(signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/net/wifi/WifiInfo-&gt;getSSID()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:356)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>Google çš„è¿™ä¸ªAPI çš„ä½œç”¨æ˜¯è·å– WiFi åï¼ŒæŸ¥çœ‹æ‰‹æœºæ‰€è¿æ¥çš„ WiFi åï¼Œåšè¡¥ç¯å¢ƒ</p>
<pre><code class="language-java">case &quot;android/net/wifi/WifiInfo-&gt;getSSID()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;DX-MOBILE&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;equalsIgnoreCase(Ljava/lang/String;)Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:412)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
</code></pre>
<p>æ­£å¸¸è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;equalsIgnoreCase(Ljava/lang/String;)Z&quot;:&#123;
    return dvmObject.getValue().toString().equalsIgnoreCase(vaList.getObjectArg(0).getValue().toString());
&#125;
</code></pre>
<p>æŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;equals(Ljava/lang/Object;)Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:415)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;equals(Ljava/lang/Object;)Z&quot;:&#123;
    return dvmObject.getValue().toString().equals(vaList.getObjectArg(0).getValue().toString());
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/String-&gt;length()I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:457)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
</code></pre>
<p>ä¾æ—§æ­£å¸¸è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/lang/String-&gt;length()I&quot;: &#123;
    return dvmObject.getValue().toString().length();
&#125;
</code></pre>
<p>è¿è¡Œï¼Œç»§ç»­æŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/lang/StringBuilder-&gt;append(Ljava/lang/CharSequence;II)Ljava/lang/StringBuilder;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:359)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>è¿™ä¸ªç¨å¾®æœ‰ç‚¹å¤æ‚</p>
<pre><code class="language-Java">				case &quot;java/lang/StringBuilder-&gt;append(Ljava/lang/CharSequence;II)Ljava/lang/StringBuilder;&quot;: &#123;
                // å‚æ•°
                CharSequence csq = (CharSequence) vaList.getObjectArg(0).getValue();
                int start = vaList.getIntArg(1);
                int end = vaList.getIntArg(2);

                // æ„é€ æ–°å†…å®¹
                StringBuilder currentValue = (StringBuilder) dvmObject.getValue();
                StringBuilder sb = new StringBuilder(currentValue);
                sb.append(csq.subSequence(start, end));

                // è¿”å›æ–°çš„ StringBuilder å¯¹è±¡ï¼ˆå› ä¸º setValue() ä¸èƒ½ç›´æ¥æ”¹ï¼‰
                return vm.resolveClass(&quot;java/lang/StringBuilder&quot;).newObject(sb);
            &#125;
</code></pre>
<p>ä¸è¿‡ä¸€æ­¥ä¸€æ­¥æ‹†å¼€æ¥å†™å°±å¥½äº†ã€‚ç„¶åç»§ç»­è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/net/wifi/WifiInfo-&gt;getBSSID()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:373)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>ä¸Šç½‘æŸ¥äº†ä¸‹è¿™ä¸ª API çš„åŠŸèƒ½ï¼Œæ˜¯è·å– WiFi æ¥å…¥ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸€èˆ¬å°±æ˜¯è·¯ç”±å™¨æ— çº¿ç½‘å¡çš„ MAC åœ°å€</p>
<p>ã€‚ä¸€æ ·é‡‡ç”¨å†™ä¸€ä¸ª demo çš„æ–¹å¼æ¥è·å–è¿™ä¸ªå€¼</p>
<pre><code class="language-Java">        // æ£€æŸ¥å¹¶ç”³è¯· Wi-Fi å’Œå®šä½æƒé™
        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED ||
                ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_WIFI_STATE) != PackageManager.PERMISSION_GRANTED) &#123;

            ActivityCompat.requestPermissions(this,
                    new String[]&#123;
                            Manifest.permission.ACCESS_FINE_LOCATION,
                            Manifest.permission.ACCESS_WIFI_STATE
                    &#125;, PERMISSION_REQUEST_CODE);
        &#125; else &#123;
            getBssid();
        &#125;
    &#125;

    // è·å– BSSID
    private void getBssid() &#123;
        WifiManager wifiManager = (WifiManager) getSystemService(WIFI_SERVICE);
        if (wifiManager != null) &#123;
            WifiInfo wifiInfo = wifiManager.getConnectionInfo();
            if (wifiInfo != null &amp;&amp; wifiInfo.getBSSID() != null) &#123;
                Log.e(&quot;å½“å‰BSSID&quot;, wifiInfo.getBSSID());
            &#125; else &#123;
                Log.e(&quot;å½“å‰BSSID&quot;, &quot;æ— æ³•è·å–BSSIDï¼Œæƒé™ä¸è¶³æˆ–æœªè¿æ¥Wi-Fi&quot;);
            &#125;
        &#125;
    &#125;

    // å¤„ç†è¿è¡Œæ—¶æƒé™å›è°ƒ
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions,
                                           @NonNull int[] grantResults) &#123;
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == PERMISSION_REQUEST_CODE) &#123;
            boolean granted = true;
            for (int res : grantResults) &#123;
                if (res != PackageManager.PERMISSION_GRANTED) &#123;
                    granted = false;
                    break;
                &#125;
            &#125;
            if (granted) &#123;
                getBssid();
            &#125; else &#123;
                Log.e(&quot;å½“å‰BSSID&quot;, &quot;æƒé™è¢«æ‹’ç»ï¼Œæ— æ³•è·å–BSSID&quot;);
            &#125;
        &#125;
    &#125;
</code></pre>
<p>ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œå› ä¸ºéœ€è¦ç”³è¯·æƒé™ã€‚ç„¶åæˆ‘è·å–çš„å€¼æ˜¯ 3c:d2:e5: ab:81:b1ã€‚è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">            case &quot;android/net/wifi/WifiInfo-&gt;getBSSID()Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;3c:d2:e5:ab:81:b1&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/net/wifi/WifiInfo-&gt;getRssi()I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:477)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
</code></pre>
<p>è¿™ä¸ª API æ˜¯ç”¨æ¥è·å– WiFi ä¿¡å·å¼ºåº¦çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ä¸Šé¢çš„æ–¹æ³• æ¥è·å–ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥éšæ„è¿”å›ä¸€ä¸ªæ­£å¸¸çš„å€¼ä¹Ÿå¯ä»¥</p>
<pre><code class="language-Java">WifiManager wifiManager = (WifiManager) getSystemService(Context.WIFI_SERVICE);
WifiInfo wifiInfo = wifiManager.getConnectionInfo();
int rssi = wifiInfo.getRssi();
Log.e(&quot;WiFi RSSI&quot;, String.valueOf(rssi));
</code></pre>
<p>æˆ‘çš„æµ‹è¯•æœºè·å–åˆ°çš„å€¼æ˜¯ -47ï¼Œè¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">            case &quot;android/net/wifi/WifiInfo-&gt;getRssi()I&quot;: &#123;
                return -47;
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/telephony/TelephonyManager-&gt;getNetworkOperator()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:376)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>è¿™ä¸ª API æ˜¯è·å–å½“å‰ç§»åŠ¨ç½‘ç»œè¿è¡Œå•†çš„ MCC + MNCã€‚æ²¡æ’å¡ï¼Œç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-Java">            case &quot;android/telephony/TelephonyManager-&gt;getNetworkOperator()Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œå°±è·‘é€šäº†</p>
<pre><code class="language-shell">[*] getLocationInfo: -|-|-|-|-|
</code></pre>
<h3 id="åä¸€ã€getPlatformInfo"><a href="#åä¸€ã€getPlatformInfo" class="headerlink" title="åä¸€ã€getPlatformInfo"></a>åä¸€ã€getPlatformInfo</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">public String getPlatformInfo()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getPlatformInfo()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>è¿è¡Œï¼ŒæŠ¥é”™</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/text/SimpleDateFormat-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:139)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
	at com.github.unidbg.linux.android.dvm.DalvikVM$24.handle(DalvikVM.java:365)
</code></pre>
<p>åŒç†å¤„ç†</p>
<pre><code class="language-Java">case &quot;java/text/SimpleDateFormat-&gt;allocObject&quot;:&#123;
    return dvmClass.newObject(signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/text/SimpleDateFormat-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/util/Locale;)V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:196)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callVoidMethodA(DvmMethod.java:234)
</code></pre>
<p>ä¾æ—§å¤„ç†ä¸ºå…¨å±€å˜é‡ï¼Œç„¶åè¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/text/SimpleDateFormat-&gt;&lt;init&gt;(Ljava/lang/String;Ljava/util/Locale;)V&quot;:&#123;
    String pattern = vaList.getObjectArg(0).getValue().toString();
    Locale locale = (Locale) vaList.getObjectArg(1).getValue();
    simpleDateFormat = new SimpleDateFormat(pattern, locale);
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: android/os/Build$VERSION-&gt;SDK:Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:103)
	at com.test4.TEST4.getStaticObjectField(TEST4.java:567)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getStaticObjectField(AbstractJni.java:53)
	at com.github.unidbg.linux.android.dvm.DvmField.getStaticObjectField(DvmField.java:106)
	at com.github.unidbg.linux.android.dvm.DalvikVM$142.handle(DalvikVM.java:2275)
</code></pre>
<p>å‰é¢æˆ‘ä»¬è¡¥è¿‡ <strong>android&#x2F;os&#x2F;Build$VERSION-&gt;SDK_INT:I</strong>ï¼Œå®ƒå’Œæ­¤å¤„ä½œç”¨ä¸€è‡´ï¼ŒåŒºåˆ«ä»…åœ¨äºè¿”å›æ•°å­—è¿˜æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="language-Java">case &quot;android/os/Build$VERSION-&gt;SDK:Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;35&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/util/Date-&gt;allocObject
	at com.github.unidbg.linux.android.dvm.AbstractJni.allocObject(AbstractJni.java:812)
	at com.test4.TEST4.allocObject(TEST4.java:144)
	at com.github.unidbg.linux.android.dvm.DvmClass.allocObject(DvmClass.java:74)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;java/util/Date-&gt;allocObject&quot;:&#123;
    return dvmClass.newObject(signature);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/util/Date-&gt;&lt;init&gt;()V
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:1007)
	at com.test4.TEST4.callVoidMethodV(TEST4.java:207)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callVoidMethodV(AbstractJni.java:990)
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªæ— å‚æ„é€ ï¼Œé‚£å¯ä»¥å›å¤´ä¿®æ”¹ allocObject é‚£é‡Œçš„ä»£ç ï¼Œæ˜¯å¾—æ€è·¯æ›´æ¸…æ™°</p>
<pre><code class="language-Java">case &quot;java/util/Date-&gt;allocObject&quot;:&#123;
    return ProxyDvmObject.createObject(vm, new Date());
&#125;
</code></pre>
<p>ç„¶åä¸‹é¢åˆå§‹åŒ–çš„æ—¶å€™å°±ä¸ç”¨åšä»€ä¹ˆäº†</p>
<pre><code class="language-Java">case &quot;java/util/Date-&gt;&lt;init&gt;()V&quot;:&#123;
    return;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: java/text/SimpleDateFormat-&gt;format(Ljava/util/Date;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:403)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>è¡¥ç¯å¢ƒï¼Œç›´æ¥è¿”å›ä¸€ä¸ªå›ºå®šçš„å·²æ ¼å¼åŒ–çš„æ—¶é—´å­—ç¬¦ä¸²</p>
<pre><code class="language-Java">            case &quot;java/text/SimpleDateFormat-&gt;format(Ljava/util/Date;)Ljava/lang/String;&quot;: &#123;
                return new StringObject(vm, &quot;2025-08-04 09:05:05&quot;);
            &#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;androidAppCnt(Landroid/content/Context;)I
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:563)
	at com.test4.TEST4.callIntMethodV(TEST4.java:510)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callIntMethodV(AbstractJni.java:529)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callIntMethodA(DvmMethod.java:134)
</code></pre>
<p><strong>jadx</strong> ä¸­çœ‹ androidAppCnt çš„å®ç°</p>
<pre><code class="language-Java">public static int androidAppCnt(Context context) &#123;
    int i;
    Object[] objArr = &#123;context&#125;;
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;e2af58080aad5d311267bb7c71e6cce2&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        return ((Integer) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;e2af58080aad5d311267bb7c71e6cce2&quot;)).intValue();
    &#125;
    int i2 = androidAppCntCache;
    if (i2 != 0) &#123;
        return i2;
    &#125;
    if (context == null) &#123;
        return 0;
    &#125;
    if (Thread.currentThread() == Looper.getMainLooper().getThread()) &#123;
        return androidAppCntCache;
    &#125;
    try &#123;
        lock.lock();
    &#125; catch (Throwable th) &#123;
        c.a(th);
    &#125;
    if (androidAppCntCache != 0) &#123;
        i = androidAppCntCache;
    &#125; else &#123;
        PackageManager pkgManager = getPkgManager(context);
        if (pkgManager == null) &#123;
            i = androidAppCntCache;
        &#125; else &#123;
            androidAppCntCache = pkgManager.getInstalledApplications(128).size();
            lock.unlock();
            return androidAppCntCache;
        &#125;
    &#125;
    lock.unlock();
    return i;
&#125;
</code></pre>
<p>ä»£ç é€»è¾‘æ˜¯åœ¨è·å–è®¾å¤‡å®‰è£…äº†å¤šå°‘ Appï¼Œç›¸æ¯”è¾ƒæ­£å¸¸çš„ç”¨æˆ·è®¾å¤‡ï¼Œçˆ¬è™«ã€é»‘ç°äº§ä¸“ç”¨è®¾å¤‡å¾€å¾€åªå®‰è£…å¾ˆå°‘çš„ä¸€äº› Appã€‚è¯»è€…å¯ä»¥éšæœºè¿”å›ä¸€ä¸ªå¤§äº 200 çš„æ•°å­—ï¼Œå¦‚æœæƒ³ç¡®å®šæµ‹è¯•æœºä¸Šçš„åº”ç”¨æ•°ï¼Œå¯ä»¥ Hook <strong>androidAppCnt</strong> å‡½æ•°æˆ–è€…ä½¿ç”¨ ADBã€‚</p>
<pre><code class="language-shell">â””â”€Î” adb shell
ares:/ $ pm list package
package:com.miui.screenrecorder
package:com.mediatek.ims
package:com.mediatek.op01.phone.plugin
package:icu.nullptr.applistdetector
package:com.android.cts.priv.ctsshim
...
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;androidAppCnt(Landroid/content/Context;)I&quot;:&#123;
    return 408;
&#125;
</code></pre>
<p>æ–°é”™è¯¯</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;appCache(Landroid/content/Context;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:406)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>å…·ä½“ä»£ç é€»è¾‘æ˜¯è®¡ç®— App ç¼“å­˜ç›®å½•å¤§å°ï¼Œç›´æ¥ Hook è·å–</p>
<pre><code class="language-js">function callSIUACollector() &#123;
  setTimeout(function () &#123;
    Java.perform(function () &#123;
      const ActivityThread = Java.use(&quot;android.app.ActivityThread&quot;);
      let context = ActivityThread.currentApplication().getApplicationContext();
      const ContextClass = Java.use(&quot;android.content.Context&quot;);
      const ctx = Java.cast(context, ContextClass);

      let SIUACollector = Java.use(
        &quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;
      );
      // ä¼ contextåˆ›å»ºå®ä¾‹
      let instance = SIUACollector.$new(ctx);

      let result = instance.appCache(ctx);
      console.log(&quot;ret: &quot; + result);
    &#125;);
  &#125;, 3000);
&#125;
callSIUACollector();
</code></pre>
<p>æˆ‘çš„æµ‹è¯•æœºæ‹¿åˆ°çš„æ•°æ®æ˜¯ 114324295ã€‚è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;appCache(Landroid/content/Context;)Ljava/lang/String;&quot;:
    return new StringObject(vm, &quot;114324295&quot;);
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;availableSystem()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:409)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>çœ‹ä¼ªä»£ç </p>
<pre><code class="language-java">public static String availableSystem() &#123;
    Object[] objArr = new Object[0];
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;234b4d16d3aab7d4062d61d2146219de&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;234b4d16d3aab7d4062d61d2146219de&quot;);
    &#125;
    try &#123;
        File dataDirectory = Environment.getDataDirectory();
        if (!readable(dataDirectory)) &#123;
            return &quot;unknown&quot;;
        &#125;
        StatFs statFs = new StatFs(dataDirectory.getPath());
        return StringUtils.toString(statFs.getAvailableBlocks() * statFs.getBlockSize());
    &#125; catch (Throwable th) &#123;
        c.a(th);
        return &quot;unknown&quot;;
    &#125;
&#125;
</code></pre>
<p>ç”¨ frida hook æµ‹è¯•ä¸€ä¸‹</p>
<pre><code class="language-js">Java.perform(function() &#123;
  let DeviceInfoWorker = Java.use(&quot;com.meituan.android.common.dfingerprint.collection.workers.DeviceInfoWorker&quot;);
  DeviceInfoWorker[&quot;availableSystem&quot;].implementation = function () &#123;
    console.log(&#39;availableSystem is called&#39;);
    let ret = this.availableSystem();
    console.log(&#39;availableSystem ret value is &#39; + ret);
    return ret;
  &#125;;
&#125;)
</code></pre>
<p>hook ç»“æœ</p>
<pre><code class="language-shell">availableSystem is called
availableSystem ret value is unknown
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;availableSystem()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;unknown&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œï¼Œè¿˜æ˜¯åœ¨è·å–è®¾å¤‡å­˜å‚¨ç›¸å…³ä¿¡æ¯</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;totalMemory()Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:412)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p><strong>Jadx</strong> ä¸­æŸ¥çœ‹å…·ä½“ä»£ç é€»è¾‘</p>
<pre><code class="language-Java">public static String totalMemory() &#123;
    Object[] objArr = new Object[0];
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, null, changeQuickRedirect2, true, &quot;a240e07aebe4d91708d281e29b9fc189&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        return (String) PatchProxy.accessDispatch(objArr, null, changeQuickRedirect2, true, &quot;a240e07aebe4d91708d281e29b9fc189&quot;);
    &#125;
    try &#123;
        FileReader fileReader = new FileReader(&quot;/proc/meminfo&quot;);
        BufferedReader bufferedReader = new BufferedReader(fileReader);
        bufferedReader.close();
        fileReader.close();
        return StringUtils.toString(Long.valueOf(bufferedReader.readLine().split(&quot;\\s+&quot;)[1]).intValue() * 1024);
    &#125; catch (Throwable th) &#123;
        c.a(th);
        return &quot;unknown&quot;;
    &#125;
&#125;
</code></pre>
<p>è¿™é‡Œæ˜¯åœ¨è®¿é—® &#x2F;proc&#x2F;meminfo çš„é¦–è¡Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ adb ä¸­å¤ç°è¿™ä¸€è¿‡ç¨‹</p>
<pre><code class="language-shell">â””â”€Î” adb shell
ares:/ $ cat /proc/meminfo
MemTotal:        7714228 kB
MemFree:          187216 kB
MemAvailable:    3950016 kB
Buffers:            7428 kB
Cached:          4022680 kB
SwapCached:       139544 kB
</code></pre>
<p>è¿›è¡Œä¸€ä¸‹å•ä½è½¬æ¢ï¼Œ7714228 * 1024 &#x3D; 7,899,369,472 B<br>ç„¶åä¹Ÿå¯ä»¥ frida hook éªŒè¯ä¸€ä¸‹</p>
<pre><code class="language-js">function callSIUACollector() &#123;
  setTimeout(function () &#123;
    Java.perform(function () &#123;
      const ActivityThread = Java.use(&quot;android.app.ActivityThread&quot;);
      let context = ActivityThread.currentApplication().getApplicationContext();
      const ContextClass = Java.use(&quot;android.content.Context&quot;);
      const ctx = Java.cast(context, ContextClass);

      let SIUACollector = Java.use(
        &quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;
      );
      // ä¼ contextåˆ›å»ºå®ä¾‹
      let instance = SIUACollector.$new(ctx);

      let result = instance.totalMemory();
      console.log(&quot;ret: &quot; + result);
    &#125;);
  &#125;, 3000);
&#125;
callSIUACollector();
</code></pre>
<p>å¾—åˆ°çš„ç»“æœ</p>
<pre><code class="language-shell">ret: 7899369472
</code></pre>
<p>ç¬¦åˆé¢„æœŸã€‚è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;totalMemory()Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;7899369472&quot;);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getFirstLaunchTime(Landroid/content/Context;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:415)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
	at com.github.unidbg.linux.android.dvm.DvmMethod.callObjectMethodA(DvmMethod.java:94)
</code></pre>
<p>getFirstLaunchTime è¯­ä¹‰æ¸…æ™°ï¼Œå³ App å®‰è£…åçš„é¦–æ¬¡å¯åŠ¨æ—¶é—´ã€‚ç›´æ¥ Hook æŸ¥çœ‹</p>
<pre><code class="language-js">function callSIUACollector() &#123;
  setTimeout(function () &#123;
    Java.perform(function () &#123;
      const ActivityThread = Java.use(&quot;android.app.ActivityThread&quot;);
      let context = ActivityThread.currentApplication().getApplicationContext();
      const ContextClass = Java.use(&quot;android.content.Context&quot;);
      const ctx = Java.cast(context, ContextClass);

      let SIUACollector = Java.use(
        &quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;
      );
      // ä¼ contextåˆ›å»ºå®ä¾‹
      let instance = SIUACollector.$new(ctx);

      let result = instance.getFirstLaunchTime(ctx);
      console.log(&quot;ret: &quot; + result);
    &#125;);
  &#125;, 3000);
&#125;
callSIUACollector();
</code></pre>
<p>hook ç»“æœ</p>
<pre><code class="language-shell">ret: 1755054762052
</code></pre>
<p>è¿™æ˜¯æ—¶é—´æˆ³ï¼Œè½¬ä¸€ä¸‹ï¼Œä¸è¿‡å¾—æ³¨æ„å•ä½æ˜¯æ¯«ç§’<br><img src="https://nshide.oss-cn-hangzhou.aliyuncs.com/img_temp/image-20250814115612408.png" alt="image-20250814115612408"></p>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getFirstLaunchTime(Landroid/content/Context;)Ljava/lang/String;&quot;:&#123;
    return new StringObject(vm, &quot;1755054762052&quot;);
&#125;
</code></pre>
<p>è¿è¡Œå¾—åˆ°ç»“æœ</p>
<pre><code class="language-shell">[*] getPlatformInfo: Android|com.dianping.v1|10.41.15|35|-|2025-08-04 09:05:05|408|114324295|-|7899369472|1755054762052|-|-|
</code></pre>
<h3 id="åäºŒã€getUserAction"><a href="#åäºŒã€getUserAction" class="headerlink" title="åäºŒã€getUserAction"></a>åäºŒã€getUserAction</h3><p>å‘èµ·è°ƒç”¨</p>
<pre><code class="language-Java">public String getUserAction()&#123;
    String result = SIUACollector.callJniMethodObject(emulator, &quot;getUserAction()Ljava/lang/String;&quot;).getValue().toString();
    return result;
&#125;
</code></pre>
<p>å¼€å§‹è¡¥ç¯å¢ƒ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;batteryHelper:Lcom/meituan/android/common/dfingerprint/collection/utils/BatteryHelper;
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:171)
	at com.test4.TEST4.getObjectField(TEST4.java:437)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getObjectField(AbstractJni.java:141)
</code></pre>
<p>ä»åå­—å¯ä»¥çœ‹å‡ºï¼Œæ˜¯å’Œç”µæ± æœ‰å…³çš„å¤„ç†</p>
<pre><code>case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;batteryHelper:Lcom/meituan/android/common/dfingerprint/collection/utils/BatteryHelper;&quot;:&#123;
    return vm.resolveClass(&quot;com/meituan/android/common/dfingerprint/collection/utils/BatteryHelper&quot;).newObject(null);
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getBatteryInfo()Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:625)
	at com.test4.TEST4.callBooleanMethodV(TEST4.java:486)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callBooleanMethodV(AbstractJni.java:603)
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯åœ¨ç¡®è®¤æ˜¯å¦å¯ä»¥è·å–ç”µæ± ç›¸å…³çš„ä¿¡æ¯</p>
<pre><code class="language-Java">private boolean getBatteryInfo() &#123;
    Object[] objArr = new Object[0];
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;2d10aac5384d6818e2765f99df76bffe&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        return ((Boolean) PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;2d10aac5384d6818e2765f99df76bffe&quot;)).booleanValue();
    &#125;
    Context context = this.mContext;
    if (context == null) &#123;
        return false;
    &#125;
    BatteryStatus batteryStatus = BatteryHelper.getInstance(context).getBatteryStatus();
    this.level = batteryStatus.batteryLevel;
    this.scale = batteryStatus.batteryScale;
    int i = batteryStatus.batteryStatus;
    int i2 = batteryStatus.batteryPlugged;
    if (i == 2 &amp;&amp; i2 == 2) &#123;
        this.status = 1;
    &#125; else &#123;
        this.status = 0;
    &#125;
    if (i2 == 2) &#123;
        this.plugged = true;
    &#125; else &#123;
        this.plugged = false;
    &#125;
    return true;
&#125;
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getBatteryInfo()Z&quot;:&#123;
    return true;
&#125;
</code></pre>
<p>ç»§ç»­è¿è¡Œ</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;level:I
	at com.github.unidbg.linux.android.dvm.AbstractJni.getIntField(AbstractJni.java:648)
	at com.github.unidbg.linux.android.dvm.AbstractJni.getIntField(AbstractJni.java:640)
</code></pre>
<p><strong>this.level</strong> åœ¨ä¸Šé¢çš„ getBatteryInfo æ–¹æ³•é‡Œè¿›è¡Œäº†èµ‹å€¼ï¼Œå¦‚æœè¿½æ ¹æº¯æºï¼Œé€»è¾‘åˆ™æ¥è‡ªäºä¸‹é¢è¿™æ®µä»£ç </p>
<pre><code class="language-Java">private void recordStatus(Intent intent) &#123;
    Object[] objArr = &#123;intent&#125;;
    ChangeQuickRedirect changeQuickRedirect2 = changeQuickRedirect;
    if (PatchProxy.isSupport(objArr, this, changeQuickRedirect2, false, &quot;ca80b285aa559be35b7dd31c0b707222&quot;, RobustBitConfig.DEFAULT_VALUE)) &#123;
        PatchProxy.accessDispatch(objArr, this, changeQuickRedirect2, false, &quot;ca80b285aa559be35b7dd31c0b707222&quot;);
    &#125; else if (intent == null) &#123;
    &#125; else &#123;
        try &#123;
            int intExtra = intent.getIntExtra(&quot;level&quot;, 0);
            int intExtra2 = intent.getIntExtra(&quot;scale&quot;, 100);
            int intExtra3 = intent.getIntExtra(&quot;status&quot;, -1);
            int intExtra4 = intent.getIntExtra(&quot;plugged&quot;, 0);
            this.mBatteryStatus.batteryTemperature = intent.getIntExtra(&quot;temperature&quot;, 0) / 10.0f;
            this.mBatteryStatus.batteryLevel = intExtra;
            this.mBatteryStatus.batteryScale = intExtra2;
            this.mBatteryStatus.batteryStatus = intExtra3;
            this.mBatteryStatus.batteryPlugged = intExtra4;
        &#125; catch (Exception e) &#123;
            c.a(e);
            DFPLog.error(e);
        &#125;
    &#125;
&#125;
</code></pre>
<p>level å°±æ˜¯å½“å‰ç”µé‡ï¼Œscale æ˜¯æ€»ç”µé‡ï¼Œå®ƒå¹¶ä¸ä¸€å®šæ˜¯ 100.status è¡¨ç¤ºæ˜¯å¦å¤„äºå……ç”µçŠ¶æ€ï¼Œplugged åˆ™è¡¨ç¤ºå……ç”µæ¨¡å¼ï¼ŒAndroid æœ‰ä¸¤ç§å……ç”µæ¨¡å¼ï¼Œ1 æ˜¯å……ç”µå™¨å……ç”µï¼Œä¹Ÿå« AC å……ç”µã€‚2 æ˜¯ USB å……ç”µï¼Œæ¯”å¦‚æ’åœ¨ç”µè„‘ä¸Šå……ç”µã€‚</p>
<p>æ ·æœ¬æ¥ä¸‹æ¥ä¼šä¾æ¬¡è·å–è¿™å››ä¸ªå­—æ®µï¼Œè¯»è€…å¯ä»¥ Hook SIUACollector å®ä¾‹ï¼Œè·å–è¿™äº›å­—æ®µã€‚æŸ¥çœ‹å®ä¾‹ä¸­æŸäº›å­—æ®µçš„å€¼ï¼Œè¿™ä¸ªåœºæ™¯ç”¨ <a target="_blank" rel="noopener" href="https://github.com/r0ysue/r0tracer/blob/main/r0tracer.js">r0tracer</a> ä¼šå¾ˆèˆ’æœã€‚</p>
<pre><code class="language-java">//A. ç®€æ˜“traceå•ä¸ªå‡½æ•°
traceClass(&quot;com.meituan.android.common.mtguard.NBridge$SIUACollector&quot;)
</code></pre>
<p>åœ¨è¾“å‡ºæ—¥å¿—ä¸­å¯ä»¥æ‰¾åˆ°ä¸‹é¢è¿™äº›</p>
<pre><code class="language-shell">int     level =&gt; 100 =&gt; 100
boolean         plugged =&gt; false =&gt; false
int     scale =&gt; 100 =&gt; 100
int     status =&gt; 0 =&gt; 0
</code></pre>
<p>æ ¹æ®ç»“æœè¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">public int getIntField(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature) &#123;
        switch (signature) &#123;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;level:I&quot;: &#123;
                return 100;
            &#125;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;scale:I&quot;: &#123;
                return 100;
            &#125;
            case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;status:I&quot;: &#123;
                return 0;
            &#125;
        &#125;
        return  super.getIntField(vm, dvmObject, signature);
    &#125;
</code></pre>
<p>ç»§ç»­</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;plugged:Z
	at com.github.unidbg.linux.android.dvm.AbstractJni.getBooleanField(AbstractJni.java:717)
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">@Override
public boolean getBooleanField(BaseVM vm, DvmObject&lt;?&gt; dvmObject, String signature) &#123;
    switch (signature)&#123;
        case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;plugged:Z&quot;:&#123;
            return false;
        &#125;
    &#125;
    return super.getBooleanField(vm, dvmObject, signature);
&#125;
</code></pre>
<p>ç”µæ± ç›¸å…³çš„å¤§æ¦‚å‘Šä¸€æ®µè½äº†</p>
<pre><code class="language-shell">java.lang.UnsupportedOperationException: com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getDataActivity(Landroid/content/Context;)Ljava/lang/String;
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:417)
	at com.test4.TEST4.callObjectMethodV(TEST4.java:424)
	at com.github.unidbg.linux.android.dvm.AbstractJni.callObjectMethodV(AbstractJni.java:262)
</code></pre>
<p>åˆšæ‰çš„ r0tracer è¿˜æœ‰ç”¨ï¼Œæ—¥å¿—ä¸­æœç´¢ getDataActivityã€‚</p>
<pre><code class="language-shell">retval: 0 =&gt; &quot;0&quot;
*** exiting com.meituan.android.common.mtguard.NBridge$SIUACollector.getDataActivity
</code></pre>
<p>è¡¥ç¯å¢ƒ</p>
<pre><code class="language-Java">case &quot;com/meituan/android/common/mtguard/NBridge$SIUACollector-&gt;getDataActivity(Landroid/content/Context;)Ljava/lang/String;&quot;:
    return new StringObject(vm, &quot;0&quot;);
</code></pre>
<p>å¾—å‡ºç»“æœ</p>
<pre><code class="language-shell">[*] getUserAction: -|100|1|0|0|-|92cbbca8-4858-40cd-b96c-4c52cd6eb17b|0|
</code></pre>
<h3 id="åä¸‰ã€å°¾å£°"><a href="#åä¸‰ã€å°¾å£°" class="headerlink" title="åä¸‰ã€å°¾å£°"></a>åä¸‰ã€å°¾å£°</h3><p>å†™è¿‡æœ€é•¿æœ€æ¯ç‡¥çš„ä¸€æ¬¡ï¼Œå†™äº†ä¸‰å¤©â€¦</p>
<h3 id="åå››ã€å‚è€ƒ"><a href="#åå››ã€å‚è€ƒ" class="headerlink" title="åå››ã€å‚è€ƒ"></a>åå››ã€å‚è€ƒ</h3><p><a target="_blank" rel="noopener" href="https://www.yuque.com/lilac-2hqvv/xdwlsg/avlc01hrko6yvr26#L4RNF">Unidbg çš„åŸºæœ¬ä½¿ç”¨ï¼ˆå…­ï¼‰</a></p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ 1621925986@qq.com </span>
    </div>
</article>


<p>
    <a  class="dashang" onclick="dashangToggle()">ğŸ’°</a>
</p>




    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: 'Ov23lif2sndX4YqUPQwk',
            clientSecret: 'c76a4c487d51bf36e4dd1496b3f44bdbea037d50',
            repo: 'NshIdE1.github.io',
            owner: 'NshIdE1',
            admin: ['NshIdE1'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2024-2025 NshIdE
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="Toggle full screen shortcut key s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

<div class="hide_box" onclick="dashangToggle()"></div>
<div class="shang_box">
    <a class="shang_close"  onclick="dashangToggle()">Ã—</a>
    <div class="shang_tit">
        <p>Help us with donation</p>
    </div>
    <div class="shang_payimg">
        <div class="pay_img">
            <img src="/img/alipay.jpg" class="alipay" title="æ‰«ç æ”¯æŒ">
            <img src="/img/weixin.jpg" class="weixin" title="æ‰«ç æ”¯æŒ">
        </div>
    </div>
    <div class="shang_payselect">
        <span><label><input type="radio" name="pay" checked value="alipay">alipay</label></span><span><label><input type="radio" name="pay" value="weixin">weixin</label></span>
    </div>
</div>


</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        
        $("input[name=pay]").on("click", function () {
            if($("input[name=pay]:checked").val()=="weixin"){
                $(".shang_box .shang_payimg .pay_img").addClass("weixin_img");
            } else {
                $(".shang_box .shang_payimg .pay_img").removeClass("weixin_img");
            }
        })
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    
    function dashangToggle() {
        $(".shang_box").fadeToggle();
        $(".hide_box").fadeToggle();
    }
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
